// Generated by CoffeeScript 1.2.1-pre
(function() {

  window.FormulaireSinscrire = (function() {

    FormulaireSinscrire.name = 'FormulaireSinscrire';

    function FormulaireSinscrire(id_form, id_button_submit) {
      this.id_form = id_form;
      this.id_button_submit = id_button_submit;
      this.ajax_formulaire();
      this.event_form();
    }

    FormulaireSinscrire.prototype.ajax_formulaire = function() {
      $(this.id_form).bind('ajax:success', function(data, response) {
        lightbox_inscription.link_top(response);
        lightbox_inscription.hide();
        light_box_information.title_header('Success');
        light_box_information.title_content('Connexion reussi');
        light_box_information.text_content('Bonjour ' + response['user']['prenom']);
        return light_box_information.show('.lightbox_information');
      });
      return $(this.id_form).bind('ajax:error', function(data, response) {
        return console.log('test');
      });
    };

    FormulaireSinscrire.prototype.extract_error = function(error, text_error) {
      var champ, type_erreur;
      for (champ in error) {
        type_erreur = error[champ];
        if (typeof type_erreur === "array") {} else {
          text_error += "<br/><strong> " + champ + "</strong> " + type_erreur;
        }
      }
      return text_error;
    };

    FormulaireSinscrire.prototype.event_form = function() {
      var that;
      that = this;
      $(this.id_button_submit).bind('click', function() {
        if (erreur === false) {
          console.log('tout est ok');
          return $(that.id_form).submit();
        }
      });
      that = this;
      $(this.id_form + ' input#client_password_confirmation').bind('keyup', function() {
        return that.password_different();
      });
      $(this.id_form + ' input#client_email').bind('change', function() {
        return that.email_existant();
      });
      return $(this.id_form + ' input').bind('change', function() {
        return that.input_is_empty("#" + ($(this).attr('id')));
      });
    };

    FormulaireSinscrire.prototype.verif_all_valid = function() {
      var erreur;
      erreur = false;
      if (this.verif_all_input()) {
        alert('Certain champ sont vide');
        erreur = true;
      }
      if (this.email_existant()) erreur = true;
      if (this.password_different()) erreur = true;
      return erreur;
    };

    FormulaireSinscrire.prototype.email_existant = function() {
      var erreur, that;
      that = this;
      erreur = false;
      $.ajax({
        type: "POST",
        async: false,
        url: "/clients/emailExist",
        data: {
          email: $(this.id_form + ' input#client_email').val()
        },
        success: function(data) {
          var message_info;
          message_info = "";
          if (data.exist === true) message_info += "existe deja";
          if (data.good_format === false) {
            message_info += "ce n'est pas une adresse mail.";
          }
          if (message_info !== "") {
            div_state.div_error($(that.id_form + ' #client_email'), message_info);
            message_information.message_error(that.id_form + " #client_email", "titre", message_info);
            erreur = true;
            return console.log(that.id_form);
          } else {
            return div_state.div_success($(that.id_form + ' #client_email'), message_info);
          }
        }
      });
      return erreur;
    };

    FormulaireSinscrire.prototype.password_different = function() {
      var password, password_confirmation;
      password = $(this.id_form + ' input#client_password').val();
      password_confirmation = $(this.id_form + ' input#client_password_confirmation').val();
      if (password === password_confirmation) {
        if (password === "") {
          div_state.div_warning($(this.id_form + ' #client_password'), "Mot de passe vide");
          return true;
        } else if (password.length < 6) {
          div_state.div_warning($(this.id_form + ' #client_password'), "Mot de passe trop court (plus de 6 caractere)");
          return true;
        } else {
          div_state.div_success($(this.id_form + ' #client_password'), "Mot de passe identique");
          return false;
        }
      } else {
        div_state.div_warning($(this.id_form + ' #client_password'), "Mot de passe different");
        return true;
      }
    };

    FormulaireSinscrire.prototype.verif_all_input = function() {
      var champ_vide;
      champ_vide = false;
      $(this.id_form + ' input').each(function() {
        if ($(this).val() === "") {
          $(this).css('border', '1px solid red');
          champ_vide = true;
          return console.log("1");
        }
      });
      return champ_vide;
    };

    FormulaireSinscrire.prototype.input_is_empty = function(id_input) {
      if ($(id_input).val() === "") {
        $(id_input).css('border', '1px solid red');
        return true;
      } else {
        $(id_input).css('border', '1px solid #CCCCCC');
        return false;
      }
    };

    FormulaireSinscrire.prototype.show = function() {
      return $(this.id_form).css('display', 'block');
    };

    FormulaireSinscrire.prototype.hide = function() {
      return $(this.id_form).css('display', 'none');
    };

    return FormulaireSinscrire;

  })();

}).call(this);
