// Generated by CoffeeScript 1.2.1-pre
(function() {

  $(document).ready(function() {
    var animation_display, cageot, cloud, event_resume_p, formulaire_inscription, formulaire_seconnecter, slider;
    cloud = {
      "generate_big_cloud": function(nombre_nuage, min_speed, max_speed) {
        var i, left, nb_nuage, time_interval, top, _results;
        nb_nuage = nombre_nuage;
        i = 0;
        _results = [];
        while (i < nb_nuage) {
          top = Math.floor(Math.random() * 80);
          left = 150 * Math.floor(Math.random() * 9);
          i++;
          $('.big_clouds').append("<span class='cloud cloud_" + i + "' style='position:absolute;top:" + top + "px;left:" + left + "px;'></span>");
          time_interval = cloud.random_perso(min_speed, max_speed);
          _results.push(cloud.move_cloud_2(".big_clouds .cloud_" + i, time_interval));
        }
        return _results;
      },
      "generate_little_cloud": function(nombre_nuage, min_speed, max_speed) {
        var i, left, nb_nuage, time_interval, top, _results;
        nb_nuage = nombre_nuage;
        i = 0;
        _results = [];
        while (i < nb_nuage) {
          top = Math.floor(Math.random() * 80);
          left = 120 * Math.floor(Math.random() * 9);
          i++;
          $('.little_clouds').append("<span class='cloud cloud_" + i + "' style='position:absolute;top:" + top + "px;left:" + left + "px;'></span>");
          time_interval = cloud.random_perso(min_speed, max_speed);
          _results.push(cloud.move_cloud_2(".little_clouds .cloud_" + i, time_interval));
        }
        return _results;
      },
      "move_cloud": function(class_cloud) {
        var left_cloud, taille_maxi;
        taille_maxi = $(window).width() - $(class_cloud).width();
        left_cloud = $(class_cloud).css('left');
        left_cloud = left_cloud.replace('px');
        if (parseInt(left_cloud) < taille_maxi) {
          left_cloud = parseInt(left_cloud) + 1;
        } else {
          left_cloud = 0;
        }
        return $(class_cloud).css('left', left_cloud + 'px');
      },
      "move_cloud_2": function(class_cloud, duree) {
        var taille_maxi;
        taille_maxi = $(window).width() - $(class_cloud).width();
        return $(class_cloud).animate({
          left: taille_maxi + "px"
        }, {
          duration: duree,
          easing: 'linear',
          complete: function() {
            $(class_cloud).css('left', '-150px');
            return cloud.move_cloud_2(class_cloud, duree);
          }
        });
      },
      "random_perso": function(min, max) {
        var var_random;
        var_random = Math.floor(Math.random() * max);
        if (var_random < min) {
          return cloud.random_perso(min, max);
        } else {
          return var_random;
        }
      }
    };
    slider = {
      "duration_fadeout": 0,
      "duration_fadein": 0,
      "duration_between": 0,
      "id_active": "",
      "next_id_active": "",
      "init": function(duration_fadeout, duration_fadein, duration_between) {
        slider.duration_fadeout = duration_fadeout;
        slider.duration_fadein = duration_fadein;
        slider.duration_between = duration_between;
        return setTimeout(slider.move_slide, slider.duration_between);
      },
      "move_slide": function() {
        var nb_slide, numero_slider;
        nb_slide = $('.container_slider>.slider').length;
        slider.id_active = $('.container_slider>.active').attr('id');
        numero_slider = parseInt(slider.id_active.replace('slider_', ''));
        if (numero_slider === nb_slide) {
          slider.next_id_active = 'slider_1';
        } else {
          slider.next_id_active = 'slider_' + (numero_slider + 1);
        }
        slider.fade_out();
        return slider.slide_out();
      },
      "set_inactive": function() {
        $("#" + slider.id_active).removeClass('active');
        return console.log(slider.id_active);
      },
      "set_active": function() {
        if ($("#" + slider.next_id_active + ">.content").length > 0) {
          $("#" + slider.next_id_active + ">.content").css('opacity', '0');
        }
        if ($("#" + slider.next_id_active + ">.image").length > 0) {
          $("#" + slider.next_id_active + ">.image").css('margin-left', '-5000px');
        }
        $("#" + slider.next_id_active).addClass('active');
        if ($("#" + slider.next_id_active + ">.content").length > 0) {
          console.log('test');
          slider.fade_in();
        }
        if ($("#" + slider.next_id_active + ">.image").length > 0) {
          return slider.slide_in();
        }
      },
      "fade_out": function() {
        return $("#" + slider.id_active + ">.content").animate({
          opacity: "0"
        }, {
          duration: slider.duration_fadeout
        });
      },
      "fade_in": function() {
        $("#" + slider.next_id_active + ">.content>.button").css('display', 'none');
        return $("#" + slider.next_id_active + ">.content").animate({
          opacity: "1"
        }, {
          duration: slider.duration_fadein,
          complete: function() {
            return $("#" + slider.next_id_active + ">.content>.button").fadeIn(1000);
          }
        });
      },
      "slide_in": function() {
        return $("#" + slider.next_id_active + ">.image").animate({
          marginLeft: "0px"
        }, {
          duration: slider.duration_fadein + 1000,
          complete: function() {
            return setTimeout(slider.move_slide, slider.duration_between);
          }
        });
      },
      "slide_out": function() {
        return $("#" + slider.id_active + ">.image").animate({
          marginLeft: "-6000px"
        }, {
          duration: slider.duration_fadeout,
          complete: function() {
            slider.set_inactive();
            return slider.set_active();
          }
        });
      }
    };
    cageot = {
      in_process_order: false,
      init: function() {
        cageot.ajax_formulaire();
        cageot.event_form_generate(".l_dock_wrapper>ul>li");
        if ($('.l_process_order ').length > 0) {
          cageot.in_process_order = true;
          cageot.hide_dock();
        }
        if ($('#form_add_product').length > 0) cageot.form_event();
        if ($('.add_product_link').length > 0) return cageot.event_button_add();
      },
      event_button_add: function() {
        return $('.add_product_link').bind('click', function() {
          var id_button, id_produit;
          id_button = $(this).attr('id');
          id_produit = id_button.replace('product_', '');
          return cageot.add_product_ajax(id_produit);
        });
      },
      add_product_ajax: function(id_produit) {
        var data_;
        data_ = {
          produit_vente_libre: {
            id: id_produit,
            nombre_pack: 1
          }
        };
        return $.ajax({
          type: "POST",
          data: data_,
          url: '/cageot/ajoutProduit',
          format: "json",
          success: function(data) {
            if ($('.dock').css('display') === 'none') cageot.show_dock();
            cageot.add(data);
            return cageot.update_html_price(data['total']);
          }
        });
      },
      form_event: function() {
        return $('#form_add_product #add_product').bind('click', function() {
          return $('#form_add_product').submit();
        });
      },
      event_form_generate: function(class_id) {
        $(class_id + '>span.deleted_p_c').bind('click', function() {
          console.log($(this).parent('li').attr('id'));
          return cageot["delete"]($(this).parent('li').attr('id'));
        });
        $(class_id + '>div>span.plus_quantite_p_c').bind('click', function() {
          return cageot.plus_quantite($(this).parent('div').parent('li').attr('id'));
        });
        return $(class_id + '>div>span.moins_quantite_p_c').bind('click', function() {
          return cageot.moins_quantite($(this).parent('div').parent('li').attr('id'));
        });
      },
      ajax_formulaire: function() {
        $('#form_add_product').bind('ajax:success', function(data, response) {
          var all_error;
          if (response.error) {
            return all_error = form_sinscrire.extract_error(response.error, "");
          } else {
            console.log($('.dock').css('display'));
            if ($('.dock').css('display') === 'none') cageot.show_dock();
            cageot.add(response);
            return cageot.update_html_price(response['total']);
          }
        });
        return $('#form_add_product').bind('ajax:error', function(data, response) {
          console.log(data);
          console.log(response);
          return message_information.message_error("form_sinscrire", "Erreur", response.responseText);
        });
      },
      add: function(response) {
        if (response['statut'] === "add") {
          cageot.add_html_product_in_cageot(response['produit']['id'], response['produit']['nombre_pack'], response['url_image']);
          return cageot.event_form_generate(".l_dock_wrapper>ul>li#" + response['produit']['id']);
        } else {
          cageot.update_html_quantite(response['produit']['id'], response['produit']['nombre_pack']);
          return console.log('update');
        }
      },
      plus_quantite: function(id_product) {
        return $.ajax({
          type: "GET",
          url: '/cageot/ajoutQuantite/' + id_product,
          format: "json",
          success: function(data) {
            if (data['statut'] === true) {
              cageot.update_html_quantite(data['produit']['id'], data['produit']['nombre_pack']);
              cageot.update_html_price(data['total']);
              if (cageot.in_process_order) {
                event_resume_p.update_html_quantite(data);
                return event_resume_p.update_html_price(data);
              }
            }
          }
        });
      },
      moins_quantite: function(id_product) {
        return $.ajax({
          type: "GET",
          url: '/cageot/suppQuantite/' + id_product,
          format: "json",
          success: function(data) {
            if (data['statut'] === "update") {
              cageot.update_html_quantite(data['produit']['id'], data['produit']['nombre_pack']);
              if (cageot.in_process_order) {
                event_resume_p.update_html_quantite(data);
                event_resume_p.update_html_price(data);
              }
            } else if (data['statut'] === "delete") {
              $('li#' + id_product).remove();
              if (cageot.in_process_order) {
                event_resume_p.delete_quantity(data);
                event_resume_p.update_html_price(0);
              }
            } else {

            }
            return cageot.verif_if_product_present(data['total']);
          }
        });
      },
      "delete": function(id_product) {
        return $.ajax({
          type: "DELETE",
          url: '/cageot/suppProduit/' + id_product,
          format: "json",
          success: function(data) {
            if (data['statut'] === true) {
              $('li#' + id_product).remove();
              return cageot.verif_if_product_present(data['total']);
            } else {

            }
          }
        });
      },
      verif_if_product_present: function(total_price) {
        if ($('.dock ul>li').length === 0) {
          cageot.hide_dock();
          return cageot.update_html_price(0);
        } else {
          return cageot.update_html_price(total_price);
        }
      },
      update_html_price: function(price) {
        var tab_price;
        tab_price = (price + '').split('.');
        if (tab_price[1]) if (parseInt(tab_price[1]) === 0) price = tab_price[0];
        return $('.checkout>.price').text(price + '€');
      },
      add_html_product_in_cageot: function(id_product, nb_pack, url_image) {
        var new_delete, new_div_minus_quantite, new_div_plus_quantite, new_image, new_li, new_nombre_pack, new_span_minus_quantite, new_span_plus_quantite, src_image;
        new_li = $(document.createElement('li'));
        new_li.attr('id', id_product);
        if (url_image !== null) {
          src_image = url_image['image']['is_small']['url'];
        } else {
          src_image = '';
        }
        new_image = $(document.createElement('img'));
        new_image.addClass('has_corners_shadow is_small');
        new_image.attr('src', src_image);
        new_nombre_pack = $(document.createElement('span'));
        new_nombre_pack.addClass("nombre_pack_p_c");
        new_nombre_pack.text(nb_pack);
        new_delete = $(document.createElement('span'));
        new_delete.addClass("deleted_p_c");
        new_div_plus_quantite = $(document.createElement('div'));
        new_div_plus_quantite.addClass('plus_btn');
        new_span_plus_quantite = $(document.createElement('span'));
        new_span_plus_quantite.addClass('plus_quantite_p_c');
        new_div_plus_quantite.append(new_span_plus_quantite);
        new_div_minus_quantite = $(document.createElement('div'));
        new_div_minus_quantite.addClass('minus_btn');
        new_span_minus_quantite = $(document.createElement('span'));
        new_span_minus_quantite.addClass('moins_quantite_p_c');
        new_div_minus_quantite.append(new_span_minus_quantite);
        new_li.append(new_image);
        new_li.append(new_nombre_pack);
        new_li.append(new_delete);
        new_li.append(new_div_plus_quantite);
        new_li.append(new_div_minus_quantite);
        return $('.l_dock_wrapper>ul').prepend(new_li);
      },
      update_html_quantite: function(id_product, nb_pack) {
        console.log('quantite_ :' + id_product);
        return $('.l_dock_wrapper>ul>li#' + id_product + '>span.nombre_pack_p_c').text(nb_pack);
      },
      show_dock: function() {
        return $('.dock').slideDown(400, "swing");
      },
      hide_dock: function() {
        return $('.dock').slideUp(400, 'swing');
      }
    };
    animation_display = {
      margin_: 0,
      opacity_debut: 1,
      init: function(opacity_debut, margin_, au_chargement_page) {
        if (au_chargement_page == null) au_chargement_page = true;
        animation_display.margin_ = margin_;
        animation_display.opacity_debut = opacity_debut;
        animation_display.init_style();
        if (au_chargement_page) {
          return animation_display.show_all();
        } else {
          animation_display.verif_scroll();
          return animation_display.see_div();
        }
      },
      init_style: function() {
        var actual_position, all_margin, new_position;
        if ($('.move_left').length > 0) {
          if ($('.move_left').css('margin-right') === "" && $('.move_left').css('margin') === "") {
            $('.move_left').css('margin-right', '0px');
          }
          if ($('.move_left').css('margin-right') === "" && $('.move_left').css('margin') !== "") {
            all_margin = $('.move_left').css('margin').split(' ');
            $('.move_left').css('margin-right', all_margin[1]);
          }
          actual_position = parseInt(($('.move_left').css('margin-right')).replace('px'));
          new_position = (actual_position - animation_display.margin_) + 'px';
          $('.move_left').css('margin-right', new_position);
          $('.move_left').css('opacity', animation_display.opacity_debut);
        }
        if ($('.move_right').length > 0) {
          $('.move_right').each(function() {
            if ($(this).css('margin-left') === "" && $(this).css('margin') === "") {
              $(this).css('margin-left', '0px');
            }
            if ($(this).css('margin-left') === "" && $(this).css('margin') !== "") {
              all_margin = $(this).css('margin').split(' ');
              if (all_margin[3] !== void 0) {
                $(this).css('margin-left', all_margin[3]);
              } else {
                $(this).css('margin-left', all_margin[1]);
              }
            }
            actual_position = parseInt(($(this).css('margin-left')).replace('px'));
            new_position = (actual_position - animation_display.margin_) + 'px';
            console.log(new_position);
            $(this).css('margin-left', new_position);
            return $(this).css('opacity', animation_display.opacity_debut);
          });
        }
        if ($('.move_bottom').length > 0) {
          if ($('.move_bottom').css('margin-top') === "" && $('.move_bottom').css('margin') === "") {
            $('.move_bottom').css('margin-top', '0px');
          }
          if ($('.move_bottom').css('margin-top') === "" && $('.move_bottom').css('margin') !== "") {
            all_margin = $('.move_bottom').css('margin').split(' ');
            if (all_margin[3] !== void 0) {
              $('.move_bottom').css('margin-top', all_margin[3]);
            } else {
              $('.move_bottom').css('margin-top', all_margin[1]);
            }
          }
          actual_position = parseInt(($('.move_bottom').css('margin-top')).replace('px'));
          new_position = (actual_position - animation_display.margin_) + 'px';
          $('.move_bottom').css('margin-top', new_position);
          $('.move_bottom').css('opacity', animation_display.opacity_debut);
        }
        if ($('.move_top').length > 0) {
          if ($('.move_top').css('margin-top') === "" && $('.move_top').css('margin') === "") {
            $('.move_top').css('margin-top', '0px');
          }
          if ($('.move_top').css('margin-top') === "" && $('.move_top').css('margin') !== "") {
            all_margin = $('.move_top').css('margin').split(' ');
            if (all_margin[3] !== void 0) {
              $('.move_top').css('margin-top', all_margin[3]);
            } else {
              $('.move_top').css('margin-top', all_margin[1]);
            }
          }
          actual_position = parseInt(($('.move_top').css('margin-top')).replace('px'));
          new_position = (actual_position + animation_display.margin_) + 'px';
          $('.move_top').css('margin-top', new_position);
          return $('.move_top').css('opacity', animation_display.opacity_debut);
        }
      },
      see_div: function(margin_) {
        return $(document).scroll(function() {
          return animation_display.verif_scroll();
        });
      },
      verif_scroll: function() {
        return $('.move_left,.move_right,.move_top,.move_bottom').each(function() {
          var offset, position_bas_div, position_document_bas, position_document_haut, position_haut_div;
          offset = $(this).offset();
          position_haut_div = offset.top;
          position_bas_div = offset.top + $(this).height();
          position_document_bas = $(document).scrollTop() + $(window).height();
          position_document_haut = $(document).scrollTop();
          if ((position_document_bas > position_haut_div && position_haut_div > position_document_haut) && (position_document_bas > position_bas_div && position_bas_div > position_document_haut)) {
            if ($(this).hasClass('move_left')) {
              animation_display.move_to_left(this);
            }
            if ($(this).hasClass('move_right')) {
              animation_display.move_to_right(this);
            }
            if ($(this).hasClass('move_bottom')) {
              animation_display.move_to_bottom(this);
            }
            if ($(this).hasClass('move_top')) {
              return animation_display.move_to_top(this);
            }
          }
        });
      },
      show_all: function() {
        $('.move_left').each(function() {
          return animation_display.move_to_left(this);
        });
        $('.move_right').each(function() {
          return animation_display.move_to_right(this);
        });
        $('.move_bottom').each(function() {
          return animation_display.move_to_bottom(this);
        });
        return $('.move_top').each(function() {
          return animation_display.move_to_top(this);
        });
      },
      move_to_left: function(element) {
        if (element == null) element = '.move_left';
        if (!$(element).hasClass('move_done')) {
          $(element).addClass('move_done');
          return $(element).animate({
            marginRight: '+=' + animation_display.margin_ + 'px',
            opacity: 1
          }, {
            duration: 1500,
            easing: 'swing'
          });
        }
      },
      move_to_right: function(element) {
        if (element == null) element = '.move_right';
        if (!$(element).hasClass('move_done')) {
          $(element).addClass('move_done');
          return $(element).animate({
            marginLeft: '+=' + animation_display.margin_ + 'px',
            opacity: 1
          }, {
            duration: 1500,
            easing: 'swing'
          });
        }
      },
      move_to_bottom: function(element) {
        if (element == null) element = '.move_bottom';
        if (!$(element).hasClass('move_done')) {
          $(element).addClass('move_done');
          return $(element).animate({
            marginTop: '+=' + animation_display.margin_ + 'px',
            opacity: 1
          }, {
            duration: 1500,
            easing: 'swing'
          });
        }
      },
      move_to_top: function(element) {
        if (element == null) element = '.move_top';
        if (!$(element).hasClass('move_done')) {
          $(element).addClass('move_done');
          return $(element).animate({
            marginTop: '-=' + animation_display.margin_ + 'px',
            opacity: 1
          }, {
            duration: 1500,
            easing: 'swing'
          });
        }
      }
    };
    event_resume_p = {
      event: function() {
        $('.price>div.close_square').bind('click', function() {
          var produit_id;
          produit_id = ($(this).parent('div').parent('div').parent('div').attr('id')).replace('raw_', '');
          return event_resume_p.delete_quantity(produit_id);
        });
        $('.quantity>span.plus').bind('click', function() {
          var produit_id;
          produit_id = parseInt(($(this).parent('div').parent('div').parent('div').attr('id')).replace('raw_', ''));
          return event_resume_p.plus_quantity(produit_id);
        });
        return $('.quantity>span.minus').bind('click', function() {
          var produit_id;
          produit_id = ($(this).parent('div').parent('div').parent('div').attr('id')).replace('raw_', '');
          return event_resume_p.minus_quantity(produit_id);
        });
      },
      plus_quantity: function(produit_id) {
        return cageot.plus_quantite(produit_id);
      },
      minus_quantity: function(produit_id) {
        return cageot.moins_quantite(produit_id);
      },
      delete_quantity: function(produit_id) {
        cageot["delete"](produit_id);
        return $('#raw_' + produit_id).animate({
          marginLeft: '-1000px'
        }, {
          duration: 1000,
          complete: function() {
            $(this).remove();
            return event_resume_p.verif_si_product();
          }
        });
      },
      verif_si_product: function() {
        if ($('.raw').length === 0) {
          return $('.products').append('<li class="raw"> Aucun produit </li>');
        }
      },
      update_html_quantite: function(data) {
        return $('#raw_' + data['produit']['id'] + '>.l_photo_description>.quantity>.sum').text(data['produit']['nombre_pack']);
      },
      update_html_price: function(data) {
        return $('.total>p').text('Total ' + data['total'] + ' €');
      }
    };
    $('.sign_up,.sign_in').bind('click', function() {
      if ($(this).hasClass('sign_up')) {
        lightbox_connexion.hide_sous_div();
        lightbox_inscription.show();
        lightbox_inscription.show_sous_div();
      }
      if ($(this).hasClass('sign_in')) {
        lightbox_inscription.hide_sous_div();
        lightbox_connexion.show();
        return lightbox_connexion.show_sous_div();
      }
    });
    formulaire_inscription = new FormulaireSinscrire('#form_sinscrire_lightbox', '#lightbox_sign_up');
    formulaire_seconnecter = new FormulaireSeConnecter('#form_se_connecter_lightbox', '#lightbox_sign_in');
    cloud.generate_big_cloud(2, 120000, 140000);
    cloud.generate_little_cloud(2, 150000, 180000);
    slider.init(1000, 1000, 5000);
    cageot.init();
    animation_display.init(0.7, 20, false);
    return event_resume_p.event();
  });

}).call(this);
