// Generated by CoffeeScript 1.2.1-pre
(function() {

  $(document).ready(function() {
    var form_areyouinscrit, form_se_connecter, form_sinscrire, message_information;
    message_information = {
      message_success: function(id, titre, message) {
        var div_message;
        div_message = '<div class="alert alert-success" style="display:block;"><a class="close" data-dismiss="alert">x</a>';
        if (titre !== "") div_message += "<h4> " + titre + " </h4>";
        if (message !== "") div_message += "<p> " + message + " </p>";
        div_message += "</div>";
        return $("#" + id).after(div_message);
      },
      message_warning: function(id, titre, message) {
        var div_message;
        div_message = '<div class="alert alert-warning" style="display:block;"><a class="close" data-dismiss="alert">x</a>';
        if (titre !== "") div_message += "<h4> " + titre + " </h4>";
        if (message !== "") div_message += "<p> " + message + " </p>";
        div_message += "</div>";
        return $("#" + id).after(div_message);
      },
      message_error: function(id, titre, message) {
        var div_message;
        div_message = '<div class="alert alert-error" style="display:block;"><a class="close" data-dismiss="alert">x</a>';
        if (titre !== "") div_message += "<h4> " + titre + " </h4>";
        if (message !== "") div_message += "<p> " + message + " </p>";
        div_message += "</div>";
        return $("#" + id).after(div_message);
      }
    };
    form_se_connecter = {
      display: function() {
        return $('#l_se_connecter').fadeIn(1000);
      },
      hide: function() {
        return $('#l_se_connecter').css('display', 'none');
      },
      ajax_formulaire: function() {
        $('#form_se_connecter').bind('ajax:success', function(data, response) {
          console.log(response);
          return message_information.message_success("form_se_connecter", "Success", response.message);
        });
        return $('#form_se_connecter').bind('ajax:error', function(data, response) {
          console.log(data);
          console.log(response);
          return message_information.message_error("form_se_connecter", "Erreur", response.responseText);
        });
      }
    };
    form_sinscrire = {
      init: function() {
        form_sinscrire.ajax_formulaire();
        form_sinscrire.form_event();
        return form_sinscrire.email_existant();
      },
      display: function() {
        return $('#l_sinscrire').fadeIn(1000);
      },
      hide: function() {
        return $('#l_sinscrire').css('display', 'none');
      },
      ajax_formulaire: function() {
        $('#form_sinscrire').bind('ajax:success', function(data, response) {
          console.log(data);
          return message_information.message_success("form_sinscrire", "Success", "Inscription r√©ussi! Veuillez vous connectez maintenant");
        });
        return $('#form_sinscrire').bind('ajax:error', function(data, response) {
          console.log(data);
          console.log(response);
          return message_information.message_error("form_sinscrire", "Erreur", response.responseText);
        });
      },
      form_event: function() {
        return $('#form_sinscrire input#client_password_confirmation').bind('change', function() {
          return form_sinscrire.verif_password();
        });
      },
      email_existant: function() {
        return $('#form_sinscrire input#client_email').bind('change', function() {
          return $.ajax({
            type: "POST",
            url: "/clients/emailExist",
            data: {
              email: $(this).val()
            },
            success: function(data) {
              var message_info;
              console.log(data);
              message_info = "";
              if (data.exist === true) message_info += "existe deja. <br/>";
              if (data.good_format === false) {
                message_info += "ce n'est pas une adresse mail.";
              }
              if (message_info !== "") {
                return message_information.message_error("form_sinscrire #client_email", "titre", message_info);
              }
            }
          });
        });
      },
      verif_password: function() {
        var password, password_confirmation;
        password = $('#form_sinscrire input#client_password').val();
        password_confirmation = $('#form_sinscrire input#client_password_confirmation').val();
        if (password === password_confirmation) {
          return message_information.message_success("form_sinscrire #client_password", "", "Mot de passe identique");
        } else {
          message_information.message_warning("form_sinscrire #client_password", "Erreur", "Mot de passe different");
          return console.log("client_password Erreur Mot de passe different");
        }
      }
    };
    form_areyouinscrit = {
      init: function() {
        form_areyouinscrit.change();
        if ($('.is_inscrit:checked').val() !== void 0) {
          return form_areyouinscrit.event($('.is_inscrit:checked').val());
        }
      },
      change: function() {
        return $('.is_inscrit').bind('change', function() {
          return form_areyouinscrit.event($(this).val());
        });
      },
      event: function(val) {
        if (val === "non") {
          form_se_connecter.hide();
          return form_sinscrire.display();
        } else if (val === "oui") {
          form_sinscrire.hide();
          return form_se_connecter.display();
        }
      }
    };
    form_se_connecter.ajax_formulaire();
    form_sinscrire.init();
    return form_areyouinscrit.init();
  });

}).call(this);
