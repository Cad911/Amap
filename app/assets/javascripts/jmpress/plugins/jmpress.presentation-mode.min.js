/*!
 * plugin for jmpress.js v0.4.0
 *
 * Copyright 2012 Kyle Robinson Young @shama & Tobias Koppers @sokra
 * Licensed MIT
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(a,b,c,d){function f(){return""+Math.round(Math.random()*1e5,0)}"use strict";var e=a.jmpress;e("defaults").presentationMode={use:!0,url:"presentation-screen.html",notesUrl:!1,transferredValues:["userZoom","userTranslateX","userTranslateY"]},e("defaults").keyboard.keys[80]="presentationPopup",e("afterInit",function(b,d){var e=d.current;e.selectMessageListeners=[];if(d.settings.presentationMode.use){c.addEventListener("message",function(b){try{var f=JSON.parse(b.data);switch(f.type){case"select":a.each(d.settings.presentationMode.transferredValues,function(a,b){d.current[b]=f[b]}),a(d.jmpress).jmpress("select",{step:"#"+f.targetId,substep:f.substep},f.reason);break;case"listen":e.selectMessageListeners.push(b.source);break;case"ok":clearTimeout(e.presentationPopupTimeout);break;case"read":try{b.source.postMessage(JSON.stringify({type:"url",url:c.location.href,notesUrl:d.settings.presentationMode.notesUrl}),"*")}catch(g){a.error("Cannot post message to source: "+g)}break;default:throw"Unknown message type: "+f.type}}catch(g){a.error("Recieved message is malformed: "+g)}});try{c.parent&&c.parent!==c&&c.parent.postMessage(JSON.stringify({type:"afterInit"}),"*")}catch(f){a.error("Cannot post message to parent: "+f)}}}),e("afterDeinit",function(b,d){if(d.settings.presentationMode.use)try{c.parent&&c.parent!==c&&c.parent.postMessage(JSON.stringify({type:"afterDeinit"}),"*")}catch(e){a.error("Cannot post message to parent: "+e)}}),e("setActive",function(b,c){var d=a(c.delegatedFrom).attr("id"),e=c.substep,f=c.reason;a.each(c.current.selectMessageListeners,function(b,g){try{var h={type:"select",targetId:d,substep:e,reason:f};a.each(c.settings.presentationMode.transferredValues,function(a,b){h[b]=c.current[b]}),g.postMessage(JSON.stringify(h),"*")}catch(i){a.error("Cannot post message to listener: "+i)}})}),e("register","presentationPopup",function(){function b(){d.jmpress("current").presentationPopupTimeout=setTimeout(b,100);try{e.postMessage(JSON.stringify({type:"url",url:c.location.href,notesUrl:d.jmpress("settings").presentationMode.notesUrl}),"*")}catch(a){}}var d=a(this),e;d.jmpress("settings").presentationMode.use&&(e=c.open(a(this).jmpress("settings").presentationMode.url),d.jmpress("current").presentationPopupTimeout=setTimeout(b,100))})})(jQuery,document,window)