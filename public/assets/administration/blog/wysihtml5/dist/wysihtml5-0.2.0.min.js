/*
 wysihtml5 v0.2.0
 https://github.com/xing/wysihtml5

 Author: Christopher Blum (https://github.com/tiff)

 Copyright (C) 2011 XING AG
 Licensed under GNU General Public License

 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.1
 Build date: 12 March 2011
*/
var wysihtml5={version:"0.2.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"ï»¿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},rangy=function(){function e(e,t){var n=typeof e[t];return n==a||n==u&&!!e[t]||"unknown"==n}function t(e,t){return typeof e[t]==u&&!!e[t]}function n(e,t){return typeof e[t]!=f}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){window.alert("Rangy not supported in your browser. Reason: "+e),g.initialized=!0,g.supported=!1}function s(){if(!g.initialized){var n,r=!1,s=!1;e(document,"createRange")&&(n=document.createRange(),d(n,c)&&m(n,l)&&(r=!0),n.detach()),(n=t(document,"body")?document.body:document.getElementsByTagName("body")[0])&&e(n,"createTextRange")&&(n=n.createTextRange(),d(n,p)&&m(n,h)&&(s=!0)),!r&&!s&&i("Neither Range nor TextRange are implemented"),g.initialized=!0,g.features={implementsDomRange:r,implementsTextRange:s},r=b.concat(y),s=0;for(n=r.length;s<n;++s)try{r[s](g)}catch(o){t(window,"console")&&e(window.console,"log")&&console.log("Init listener threw an exception. Continuing.",o)}}}function o(e){this.name=e,this.supported=this.initialized=!1}var u="object",a="function",f="undefined",l="startContainer,startOffset,endContainer,endOffset,collapsed,commonAncestorContainer,START_TO_START,START_TO_END,END_TO_START,END_TO_END".split(","),c="setStart,setStartBefore,setStartAfter,setEnd,setEndBefore,setEndAfter,collapse,selectNode,selectNodeContents,compareBoundaryPoints,deleteContents,extractContents,cloneContents,insertNode,surroundContents,cloneRange,toString,detach".split(","),h="boundingHeight,boundingLeft,boundingTop,boundingWidth,htmlText,text".split(","),p="collapse,compareEndPoints,duplicate,getBookmark,moveToBookmark,moveToElementText,parentElement,pasteHTML,select,setEndPoint".split(","),d=r(e),v=r(t),m=r(n),g={initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:d,areHostObjects:v,areHostProperties:m},features:{},modules:{},config:{alertOnWarn:!1}};g.fail=i,g.warn=function(e){e="Rangy warning: "+e,g.config.alertOnWarn?window.alert(e):typeof window.console!=f&&typeof window.console.log!=f&&window.console.log(e)},g.init=s;var y=[],b=[];g.addInitListener=function(e){g.initialized?e(g):y.push(e)};var w=[];g.addCreateMissingNativeApiListener=function(e){w.push(e)},g.createMissingNativeApi=function(e){e=e||window,s();for(var t=0,n=w.length;t<n;++t)w[t](e)},o.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},o.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)},g.createModule=function(e,t){var n=new o(e);g.modules[e]=n,b.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},g.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=g.modules[i];if(!r||!(r instanceof o))throw Error("Module '"+i+"' not found");if(!r.supported)throw Error("Module '"+i+"' not supported")}};var E=!1,v=function(){E||(E=!0,g.initialized||s())};if(typeof window==f)i("No window found");else{if(typeof document!=f)return e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",v,!1),e(window,"addEventListener")?window.addEventListener("load",v,!1):e(window,"attachEvent")?window.attachEvent("onload",v):i("Window does not have required addEventListener or attachEvent method"),g;i("No document found")}}();rangy.createModule("DomUtil",function(e,t){function n(e){for(var t=0;e=e.previousSibling;)t++;return t}function r(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(v(n,r))return r;return null}function i(e,t,n){for(n=n?e:e.parentNode;n;){e=n.parentNode;if(e===t)return n;n=e}return null}function s(e){return e=e.nodeType,3==e||4==e||8==e}function o(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function u(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=h)return e.ownerDocument;if(typeof e.document!=h)return e.document;if(e.parentNode)return u(e.parentNode);throw Error("getDocument: no document found for node")}function a(e){return e?s(e)?'"'+e.data+'"':1==e.nodeType?"<"+e.nodeName+(e.id?' id="'+e.id+'"':"")+">["+e.childNodes.length+"]":e.nodeName:"[No node]"}function f(e){this._next=this.root=e}function l(e,t){this.node=e,this.offset=t}function c(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var h="undefined",p=e.util;p.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),p.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var d=document.createElement("div");p.areHostMethods(d,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation"),d=document.createTextNode("test"),p.areHostMethods(d,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");var v=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};f.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t;if(this._current){t=e.firstChild;if(!t)for(t=null;e!==this.root&&!(t=e.nextSibling);)e=e.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},l.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+a(this.node)+":"+this.offset+")]"}},c.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},c.prototype.toString=function(){return this.message},e.dom={arrayContains:v,getNodeIndex:n,getCommonAncestor:r,isAncestorOf:function(e,t,n){for(t=n?t:t.parentNode;t;){if(t===e)return!0;t=t.parentNode}return!1},getClosestAncestorIn:i,isCharacterDataNode:s,insertAfter:o,splitDataNode:function(e,t){var n;return 3==e.nodeType?n=e.splitText(t):(n=e.cloneNode(),n.deleteData(0,t),e.deleteData(0,e.length-t),o(n,e)),n},getDocument:u,getWindow:function(e){e=u(e);if(typeof e.defaultView!=h)return e.defaultView;if(typeof e.parentWindow!=h)return e.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(e){if(typeof e.contentWindow!=h)return e.contentWindow;if(typeof e.contentDocument!=h)return e.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(e){if(typeof e.contentDocument!=h)return e.contentDocument;if(typeof e.contentWindow!=h)return e.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(e){return p.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]},comparePoints:function(e,t,s,o){var u;if(e==s)return t===o?0:t<o?-1:1;if(u=i(s,e,!0))return t<=n(u)?-1:1;if(u=i(e,s,!0))return n(u)<o?-1:1;t=r(e,s),e=e===t?t:i(e,t,!0),s=s===t?t:i(s,t,!0);if(e===s)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(t=t.firstChild;t;){if(t===e)return-1;if(t===s)return 1;t=t.nextSibling}throw Error("Should not be here!")},inspectNode:a,createIterator:function(e){return new f(e)},DomPosition:l},e.DOMException=c}),rangy.createModule("DomRange",function(e){function t(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&D.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!D.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:D.getClosestAncestorIn(this.sc,n,!0),this._last=this.ec===n&&!D.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:D.getClosestAncestorIn(this.ec,n,!0))}}function n(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function r(e){return D.getDocument(e.startContainer)}function i(e,t,n){if(t=e._listeners[t])for(var r=0,i=t.length;r<i;++r)t[r].call(e,{target:e,args:n})}function s(e){return new P(e.parentNode,D.getNodeIndex(e))}function o(e){return new P(e.parentNode,D.getNodeIndex(e)+1)}function u(e){return D.isCharacterDataNode(e)?e.length:e.childNodes?e.childNodes.length:0}function a(e,t,n){var r=11==e.nodeType?e.firstChild:e;return D.isCharacterDataNode(t)?n==t.length?D.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:D.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function f(e){for(var t,n,i=r(e.range).createDocumentFragment();n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(t=e.getSubtreeIterator(),n.appendChild(f(t)),t.detach(!0));if(10==n.nodeType)throw new H("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function l(e,t,n){for(var r,i,n=n||{stop:!1};r=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(r)){n.stop=!0;break}if(r=e.getSubtreeIterator(),l(r,t,n),r.detach(!0),n.stop)break}else for(r=D.createIterator(r);i=r.next();)if(!1===t(i)){n.stop=!0;return}}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function h(e){for(var t,n=r(e.range).createDocumentFragment(),i;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(h(i)),i.detach(!0)):e.remove();if(10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function p(e,n,r){var i=!!n&&!!n.length,s,o=!!r;i&&(s=RegExp("^("+n.join("|")+")$"));var u=[];return l(new t(e,!1),function(e){(!i||s.test(e.nodeType))&&(!o||r(e))&&u.push(e)}),u}function d(e){return"["+("undefined"==typeof e.getName?"Range":e.getName())+"("+D.inspectNode(e.startContainer)+":"+e.startOffset+", "+D.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function v(e,t,n){this.nodes=p(e,t,n),this._next=this.nodes[0],this._pointer=0}function m(e,t){return 3!=e.nodeType&&(D.isAncestorOf(e,t.startContainer,!0)||D.isAncestorOf(e,t.endContainer,!0))}function g(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){r=i.nodeType;if(D.arrayContains(e,r))return i;i=i.parentNode}return null}}function y(e){for(var t;t=e.parentNode;)e=t;return e}function b(e,t){if(U(e,t))throw new n("INVALID_NODE_TYPE_ERR")}function w(e){if(!e.startContainer)throw new H("INVALID_STATE_ERR")}function E(e,t){if(!D.arrayContains(t,e.nodeType))throw new n("INVALID_NODE_TYPE_ERR")}function S(e,t){if(0>t||t>(D.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function x(e,t){if(q(e,!0)!==q(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function T(e){if(R(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function N(e,t){if(!e)throw new H(t)}function C(e){if(!q(e.startContainer,!0)||!q(e.endContainer,!0)||!(e.startOffset<=(D.isCharacterDataNode(e.startContainer)?e.startContainer.length:e.startContainer.childNodes.length))||!(e.endOffset<=(D.isCharacterDataNode(e.endContainer)?e.endContainer.length:e.endContainer.childNodes.length)))throw Error("Range Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function k(e){e.START_TO_START=W,e.START_TO_END=X,e.END_TO_END=V,e.END_TO_START=$,e.NODE_BEFORE=J,e.NODE_AFTER=K,e.NODE_BEFORE_AND_AFTER=Q,e.NODE_INSIDE=G}function L(e){k(e),k(e.prototype)}function A(e,i,g){function k(e,t){return function(n){w(this),E(n,B),E(y(n),j),n=(e?s:o)(n),(t?A:O)(this,n.node,n.offset)}}function A(e,t,n){var r=e.endContainer,s=e.endOffset;if(t!==e.startContainer||n!==this.startOffset){if(y(t)!=y(r)||1==D.comparePoints(t,n,r,s))r=t,s=n;i(e,t,n,r,s)}}function O(e,t,n){var r=e.startContainer,s=e.startOffset;if(t!==e.endContainer||n!==this.endOffset){if(y(t)!=y(r)||-1==D.comparePoints(t,n,r,s))r=t,s=n;i(e,r,s,t,n)}}function M(e,t,n){(t!==e.startContainer||n!==this.startOffset||t!==e.endContainer||n!==this.endOffset)&&i(e,t,n,t,n)}function P(e){return function(){w(this),C(this);var n=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,u=new t(this,!0);return n!==s&&(n=D.getClosestAncestorIn(n,s,!0),r=o(n),n=r.node,r=r.offset),l(u,T),u.reset(),s=e(u),u.detach(),i(this,n,r,n,r),s}}e.prototype={attachListener:function(e,t){this._listeners[e].push(t)},setStart:function(e,t){w(this),b(e,!0),S(e,t),A(this,e,t)},setEnd:function(e,t){w(this),b(e,!0),S(e,t),O(this,e,t)},setStartBefore:k(!0,!0),setStartAfter:k(!1,!0),setEndBefore:k(!0,!1),setEndAfter:k(!1,!1),collapse:function(e){w(this),C(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){w(this),b(e,!0),i(this,e,0,e,u(e))},selectNode:function(e){w(this),b(e,!1),E(e,B);var t=s(e),e=o(e);i(this,t.node,t.offset,e.node,e.offset)},compareBoundaryPoints:function(e,t){w(this),C(this),x(this.startContainer,t.startContainer);var n=e==$||e==W?"start":"end",r=e==X||e==W?"start":"end";return D.comparePoints(this[n+"Container"],this[n+"Offset"],t[r+"Container"],t[r+"Offset"])},insertNode:function(e){w(this),C(this),E(e,F),T(this.startContainer);if(D.isAncestorOf(e,this.startContainer,!0))throw new H("HIERARCHY_REQUEST_ERR");this.setStartBefore(a(e,this.startContainer,this.startOffset))},cloneContents:function(){w(this),C(this);var e,n;return this.collapsed?r(this).createDocumentFragment():this.startContainer===this.endContainer&&D.isCharacterDataNode(this.startContainer)?(e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),n=r(this).createDocumentFragment(),n.appendChild(e),n):(n=new t(this,!0),e=f(n),n.detach(),e)},extractContents:P(h),deleteContents:P(c),canSurroundContents:function(){w(this),C(this),T(this.startContainer),T(this.endContainer);var e=new t(this,!0),n=e._first&&m(e._first,this)||e._last&&m(e._last,this);return e.detach(),!n},surroundContents:function(e){E(e,I);if(!this.canSurroundContents())throw new n("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this),C(this);for(var e=new _(r(this)),t=z.length,n;t--;)n=z[t],e[n]=this[n];return e},detach:function(){g(this)},toString:function(){w(this),C(this);var e=this.startContainer;if(e===this.endContainer&&D.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var n=[],e=new t(this,!0);return l(e,function(e){(3==e.nodeType||4==e.nodeType)&&n.push(e.data)}),e.detach(),n.join("")},compareNode:function(e){w(this),C(this);var t=e.parentNode,n=D.getNodeIndex(e);if(!t)throw new H("NOT_FOUND_ERR");return e=this.comparePoint(t,n),t=this.comparePoint(t,n+1),0>e?0<t?Q:J:0<t?K:G},comparePoint:function(e,t){return w(this),C(this),N(e,"HIERARCHY_REQUEST_ERR"),x(e,this.startContainer),0>D.comparePoints(e,t,this.startContainer,this.startOffset)?-1:0<D.comparePoints(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:function(e){w(this);var t=r(this),n=t.createElement("div");n.innerHTML=e;for(e=t.createDocumentFragment();t=n.firstChild;)e.appendChild(t);return e},intersectsNode:function(e,t){w(this),C(this),N(e,"NOT_FOUND_ERR");if(D.getDocument(e)!==r(this))return!1;var n=e.parentNode,i=D.getNodeIndex(e);N(n,"NOT_FOUND_ERR");var s=D.comparePoints(n,i,this.endContainer,this.endOffset),n=D.comparePoints(n,i+1,this.startContainer,this.startOffset);return t?0>=s&&0<=n:0>s&&0<n},isPointInRange:function(e,t){return w(this),C(this),N(e,"HIERARCHY_REQUEST_ERR"),x(e,this.startContainer),0<=D.comparePoints(e,t,this.startContainer,this.startOffset)&&0>=D.comparePoints(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e){w(this),C(this);if(r(e)!=r(this))throw new H("WRONG_DOCUMENT_ERR");return 0>D.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset)&&0<D.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset)},intersection:function(e){if(this.intersectsRange(e)){var t=D.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=D.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==G},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&0>=this.comparePoint(e,u(e))},splitBoundaries:function(){w(this),C(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,s=e===n;D.isCharacterDataNode(n)&&r<n.length&&D.splitDataNode(n,r),D.isCharacterDataNode(e)&&0<t&&(e=D.splitDataNode(e,t),s&&(r-=t,n=e),t=0),i(this,e,t,n,r)},normalizeBoundaries:function(){w(this),C(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(i){var s=i.previousSibling;s&&s.nodeType==i.nodeType&&(e=i,t=s.length,i.insertData(0,s.data),s.parentNode.removeChild(s),e==n&&(r+=t,n=e))},u=!0;D.isCharacterDataNode(n)?n.length==r&&s(n):(0<r&&(u=n.childNodes[r-1])&&D.isCharacterDataNode(u)&&s(u),u=!this.collapsed),u?D.isCharacterDataNode(e)?0==t&&o(e):t<e.childNodes.length&&(s=e.childNodes[t])&&D.isCharacterDataNode(s)&&o(s):(e=n,t=r),i(this,e,t,n,r)},createNodeIterator:function(e,t){return w(this),C(this),new v(this,e,t)},getNodes:function(e,t){return w(this),C(this),p(this,e,t)},collapseToPoint:function(e,t){w(this),C(this),b(e,!0),S(e,t),M(this,e,t)},collapseBefore:function(e){w(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){w(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return _.rangesEqual(this,e)},inspect:function(){return d(this)}},L(e)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:D.getCommonAncestor(e.startContainer,e.endContainer)}function M(e,t,n,r,s){var o=e.startContainer!==t||e.startOffset!==n,u=e.endContainer!==r||e.endOffset!==s;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=s,O(e),i(e,"boundarychange",{startMoved:o,endMoved:u})}function _(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},O(this)}e.requireModules(["DomUtil"]);var D=e.dom,P=D.DomPosition,H=e.DOMException;t.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,D.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!D.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){return m(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new _(r(this.range));var n=this._current,i=n,s=0,o=n,a=u(n);D.isAncestorOf(n,this.sc,!0)&&(i=this.sc,s=this.so),D.isAncestorOf(n,this.ec,!0)&&(o=this.ec,a=this.eo),M(e,i,s,o,a)}return new t(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},n.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},n.prototype.toString=function(){return this.message},v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._pointer],this._current},detach:function(){this._current=this._next=this.nodes=null}};var B=[1,3,4,5,7,8,10],j=[2,9,11],F=[1,3,4,5,7,8,10,11],I=[1,3,4,5,7,8],q=g([9,11]),R=g([5,6,10,12]),U=g([6,10,12]),z="startContainer,startOffset,endContainer,endOffset,collapsed,commonAncestorContainer".split(","),W=0,X=1,V=2,$=3,J=0,K=1,Q=2,G=3;A(_,M,function(e){w(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,i(e,"detach",null),e._listeners=null}),_.fromRange=function(e){var t=new _(r(e));return M(t,e.startContainer,e.startOffset,e.endContainer,e.endOffset),t},_.rangeProperties=z,_.RangeIterator=t,_.copyComparisonConstants=L,_.createPrototypeRange=A,_.inspect=d,_.getRangeDocument=r,_.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},_.getEndOffset=u,e.DomRange=_,e.RangeException=n}),rangy.createModule("WrappedRange",function(e){function t(e,t,n,r){var o=e.duplicate();o.collapse(n);var u=o.parentElement();i.isAncestorOf(t,u,!0)||(u=t);if(!u.canHaveHTML)return new s(u.parentNode,i.getNodeIndex(u));var t=i.getDocument(u).createElement("span"),a,l=n?"StartToStart":"StartToEnd";do u.insertBefore(t,t.previousSibling),o.moveToElementText(t);while(0<(a=o.compareEndPoints(l,e))&&t.previousSibling);l=t.nextSibling;if(-1==a&&l&&i.isCharacterDataNode(l)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);if(/[\r\n]/.test(l.data)){u=o.duplicate(),n=u.text.replace(/\r\n/g,"\r").length;for(n=u.moveStart("character",n);-1==u.compareEndPoints("StartToEnd",u);)n++,u.moveStart("character",1)}else n=o.text.length;u=new s(l,n)}else l=(r||!n)&&t.previousSibling,u=(n=(r||n)&&t.nextSibling)&&i.isCharacterDataNode(n)?new s(n,0):l&&i.isCharacterDataNode(l)?new s(l,l.length):new s(u,i.getNodeIndex(t));return t.parentNode.removeChild(t),u}function n(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u=o.body.createTextRange(),a=i.isCharacterDataNode(e.node);return a?(n=e.node,r=n.parentNode):(n=e.node.childNodes,n=s<n.length?n[s]:null,r=e.node),o=o.createElement("span"),o.innerHTML="&#feff;",n?r.insertBefore(o,n):r.appendChild(o),u.moveToElementText(o),u.collapse(!t),r.removeChild(o),a&&u[t?"moveStart":"moveEnd"]("character",s),u}e.requireModules(["DomUtil","DomRange"]);var r,i=e.dom,s=i.DomPosition,o=e.DomRange;if(e.features.implementsDomRange)(function(){function e(e){for(var t=n.length,r;t--;)r=n[t],e[r]=e.nativeRange[r]}var t,n=o.rangeProperties,s;r=function(t){if(!t)throw Error("Range must be specified");this.nativeRange=t,e(this)},o.createPrototypeRange(r,function(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n;(e.endContainer!==r||e.endOffset!=i)&&e.setEnd(r,i),s&&e.setStart(t,n)},function(e){e.nativeRange.detach(),e.detached=!0;for(var t=n.length,r;t--;)r=n[t],e[r]=null}),t=r.prototype,t.selectNode=function(t){this.nativeRange.selectNode(t),e(this)},t.deleteContents=function(){this.nativeRange.deleteContents(),e(this)},t.extractContents=function(){var t=this.nativeRange.extractContents();return e(this),t},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(t){this.nativeRange.surroundContents(t),e(this)},t.collapse=function(t){this.nativeRange.collapse(t),e(this)},t.cloneRange=function(){return new r(this.nativeRange.cloneRange())},t.refresh=function(){e(this)},t.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");i.getBody(document).appendChild(u);var a=document.createRange();a.setStart(u,0),a.setEnd(u,0);try{a.setStart(u,1),t.setStart=function(t,n){this.nativeRange.setStart(t,n),e(this)},t.setEnd=function(t,n){this.nativeRange.setEnd(t,n),e(this)},s=function(t){return function(n){this.nativeRange[t](n),e(this)}}}catch(f){t.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(r){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}e(this)},t.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(r){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}e(this)},s=function(t,n){return function(r){try{this.nativeRange[t](r)}catch(i){this.nativeRange[n](r),this.nativeRange[t](r)}e(this)}}}t.setStartBefore=s("setStartBefore","setEndBefore"),t.setStartAfter=s("setStartAfter","setEndAfter"),t.setEndBefore=s("setEndBefore","setStartBefore"),t.setEndAfter=s("setEndAfter","setStartAfter"),a.selectNodeContents(u),t.selectNodeContents=a.startContainer==u&&a.endContainer==u&&0==a.startOffset&&a.endOffset==u.length?function(t){this.nativeRange.selectNodeContents(t),e(this)}:function(e){this.setStart(e,0),this.setEnd(e,o.getEndOffset(e))},a.selectNodeContents(u),a.setEnd(u,3),s=document.createRange(),s.selectNodeContents(u),s.setEnd(u,4),s.setStart(u,2),t.compareBoundaryPoints=-1==a.compareBoundaryPoints(a.START_TO_END,s)&&1==a.compareBoundaryPoints(a.END_TO_START,s)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},i.getBody(document).removeChild(u),a.detach(),s.detach()})();else if(e.features.implementsTextRange){r=function(e){this.textRange=e,this.refresh()},r.prototype=new o(document),r.prototype.refresh=function(){var e,n,r=this.textRange;e=r.parentElement();var s=r.duplicate();s.collapse(!0),n=s.parentElement(),s=r.duplicate(),s.collapse(!1),r=s.parentElement(),n=n==r?n:i.getCommonAncestor(n,r),n=n==e?n:i.getCommonAncestor(e,n),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?n=e=t(this.textRange,n,!0,!0):(e=t(this.textRange,n,!0,!1),n=t(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(n.node,n.offset)},r.rangeToTextRange=function(e){if(e.collapsed)return n(new s(e.startContainer,e.startOffset),!0,!0);var t=n(new s(e.startContainer,e.startOffset),!0,!1),r=n(new s(e.endContainer,e.endOffset),!1,!1),e=i.getDocument(e.startContainer).body.createTextRange();return e.setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",r),e},o.copyComparisonConstants(r);var u=function(){return this}();"undefined"==typeof u.Range&&(u.Range=r)}r.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(t){t=t||document;if(e.features.implementsDomRange)return t.createRange();if(e.features.implementsTextRange)return t.body.createTextRange()},e.createRange=function(t){return new r(e.createNativeRange(t||document))},e.createRangyRange=function(e){return new o(e||document)},e.createIframeRange=function(t){return e.createRange(i.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(i.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){t=t.document,"undefined"==typeof t.createRange&&(t.createRange=function(){return e.createRange(this)}),t=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e,t,n){var r=n?"end":"start",n=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function r(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function i(t){var n;if(t instanceof h){if(n=t._selectionNativeRange,!n)n=e.createNativeRange(l.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null})}else t instanceof p?n=t.nativeRange:window.Range&&t instanceof Range&&(n=t);return n}function s(e){var t=e.getNodes(),n;e:if(!t.length||1!=t[0].nodeType)n=!1;else{n=1;for(var r=t.length;n<r;++n)if(!l.isAncestorOf(t[0],t[n])){n=!1;break e}n=!0}if(!n)throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function o(t){t._ranges.length=0;if("None"==t.nativeSelection.type)r(t);else{var i=t.nativeSelection.createRange();t.rangeCount=i.length;for(var s,o=l.getDocument(i.item(0)),u=0;u<t.rangeCount;++u)s=e.createRange(o),s.selectNode(i.item(u)),t._ranges.push(s);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,n(t,t._ranges[t.rangeCount-1],!1)}}function u(e){this.nativeSelection=e,this._ranges=[],this.refresh()}function a(e,t){if(e.anchorNode&&l.getDocument(e.anchorNode)!==l.getDocument(t))throw new d("WRONG_DOCUMENT_ERR")}function f(e){var t=[],n=new v(e.anchorNode,e.anchorOffset),r=new v(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var s=0,o=e.rangeCount;s<o;++s)t[s]=h.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var l=e.dom,c=e.util,h=e.DomRange,p=e.WrappedRange,d=e.DOMException,v=l.DomPosition,m,g;e.util.isHostMethod(window,"getSelection")?m=function(e){return(e||window).getSelection()}:e.util.isHostObject(document,"selection")?m=function(e){return(e||window).document.selection}:t.fail("No means of obtaining a selection object"),e.getNativeSelection=m;var y=m(),b=e.createNativeRange(document),w=l.getBody(document),E=c.areHostObjects(y,c.areHostProperties(y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=E;var S=c.isHostMethod(y,"extend");e.features.selectionHasExtend=S;var x="number"==typeof y.rangeCount;e.features.selectionHasRangeCount=x;var T=!1,N=!0;c.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof y.rangeCount&&e.features.implementsDomRange&&function(){var t=w.appendChild(document.createTextNode("One")),n=w.appendChild(document.createTextNode("Two")),r=e.createNativeRange(document);r.selectNodeContents(t);var i=e.createNativeRange(document);i.selectNodeContents(n),y.removeAllRanges(),y.addRange(r),y.addRange(i),T=2==y.rangeCount,y.removeAllRanges(),t.parentNode.removeChild(t),n.parentNode.removeChild(n),t=document.createElement("p"),t.contentEditable=!1,n=t.appendChild(document.createTextNode("test")),w.appendChild(t),r=e.createRange(),r.collapseToPoint(n,1),y.addRange(r.nativeRange),N=1==y.rangeCount,y.removeAllRanges(),w.removeChild(t)}(),e.features.selectionSupportsMultipleRanges=T,e.features.collapsedNonEditableSelectionsSupported=N;var C=c.isHostProperty(y,"type"),k=!1,L;w&&c.isHostMethod(w,"createControlRange")&&(L=w.createControlRange(),c.areHostProperties(L,["item","add"])&&(k=!0)),e.features.implementsControlRange=k,g=E?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var A;c.isHostMethod(y,"getRangeAt")?A=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:E&&(A=function(t){var n=l.getDocument(t.anchorNode),n=e.createRange(n);return n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){var e=e||window,t=e._rangySelection;return t?(t.nativeSelection=m(e),t.refresh()):(t=new u(m(e)),e._rangySelection=t),t},e.getIframeSelection=function(t){return e.getSelection(l.getIframeWindow(t))},L=u.prototype;if(E&&c.areHostMethods(y,["removeAllRanges","addRange"])){L.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),r(this)};var O=function(t,n){var r=h.getRangeDocument(n),r=e.createRange(r);r.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(i(r)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};L.addRange=x?function(t,r){if(r&&S)O(this,t);else{var s;T?s=this.rangeCount:(this.removeAllRanges(),s=0),this.nativeSelection.addRange(i(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==s+1?(e.config.checkSelectionRanges&&(s=A(this
.nativeSelection,this.rangeCount-1))&&!h.rangesEqual(s,t)&&(t=new p(s)),this._ranges[this.rangeCount-1]=t,n(this,t,D(this.nativeSelection)),this.isCollapsed=g(this)):this.refresh()}}:function(e,t){t&&S?O(this,e):(this.nativeSelection.addRange(i(e)),this.refresh())},L.setRanges=function(e){this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}else{if(!(c.isHostMethod(y,"empty")&&c.isHostMethod(b,"select")&&C&&k))return t.fail("No means of selecting a Range or TextRange was found"),!1;L.removeAllRanges=function(){try{if(this.nativeSelection.empty(),"None"!=this.nativeSelection.type){var e;if(this.anchorNode)e=l.getDocument(this.anchorNode);else if("Control"==this.nativeSelection.type){var t=this.nativeSelection.createRange();t.length&&(e=l.getDocument(t.item(0)).body.createTextRange())}e&&(e.body.createTextRange().select(),this.nativeSelection.empty())}}catch(n){}r(this)},L.addRange=function(e){if("Control"==this.nativeSelection.type){for(var t=this.nativeSelection.createRange(),e=s(e),r=l.getDocument(t.item(0)),r=l.getBody(r).createControlRange(),i=0,u=t.length;i<u;++i)r.add(t.item(i));try{r.add(e)}catch(a){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),o(this)}else p.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,n(this,e,!1)},L.setRanges=function(e){this.removeAllRanges();var t=e.length;if(1<t){for(var n=l.getDocument(e[0].startContainer),n=l.getBody(n).createControlRange(),r=0,i;r<t;++r){i=s(e[r]);try{n.add(i)}catch(u){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}n.select(),o(this)}else t&&this.addRange(e[0])}}L.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new d("INDEX_SIZE_ERR");return this._ranges[e]};var M;if(c.isHostMethod(y,"getRangeAt")&&"number"==typeof y.rangeCount)M=function(t){t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var i=0,s=t.rangeCount;i<s;++i)t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i));n(t,t._ranges[t.rangeCount-1],D(t.nativeSelection)),t.isCollapsed=g(t)}else r(t)};else if(E&&"boolean"==typeof y.isCollapsed&&"boolean"==typeof b.collapsed&&e.features.implementsDomRange)M=function(e){var t;t=e.nativeSelection,t.anchorNode?(t=A(t,0),e._ranges=[t],e.rangeCount=1,t=e.nativeSelection,e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset,e.isCollapsed=g(e)):r(e)};else{if(!c.isHostMethod(y,"createRange")||!e.features.implementsTextRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;M=function(e){var t=e.nativeSelection.createRange();"Control"==e.nativeSelection.type?o(e):t&&"undefined"!=typeof t.text?(t=new p(t),e._ranges=[t],n(e,t,!1),e.rangeCount=1,e.isCollapsed=t.collapsed):r(e)}}L.refresh=function(e){var t=e?this._ranges.slice(0):null;M(this);if(e){e=t.length;if(e!=this._ranges.length)return!1;for(;e--;)if(!h.rangesEqual(t[e],this._ranges[e]))return!1;return!0}};var _=function(e,t){var n=e.getAllRanges(),i=!1;e.removeAllRanges();for(var s=0,o=n.length;s<o;++s)i||t!==n[s]?e.addRange(n[s]):i=!0;e.rangeCount||r(e)};L.removeRange=C&&k?function(e){if("Control"==this.nativeSelection.type){for(var t=this.nativeSelection.createRange(),e=s(e),n=l.getDocument(t.item(0)),n=l.getBody(n).createControlRange(),r,i=!1,u=0,a=t.length;u<a;++u)r=t.item(u),r!==e||i?n.add(t.item(u)):i=!0;n.select(),o(this)}else _(this,e)}:function(e){_(this,e)};var D;E&&e.features.implementsDomRange?(D=function(e){var t=!1;return e.anchorNode&&(t=1==l.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},L.isBackwards=function(){return D(this)}):D=L.isBackwards=function(){return!1},L.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},L.collapse=function(t,n){a(this,t);var r=e.createRange(l.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},L.collapseToStart=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},L.collapseToEnd=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},L.selectAllChildren=function(t){a(this,t);var n=e.createRange(l.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},L.deleteFromDocument=function(){if(this.rangeCount){var e=this.getAllRanges();this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)e[t].deleteContents();this.addRange(e[n-1])}},L.getAllRanges=function(){return this._ranges.slice(0)},L.setSingleRange=function(e){this.setRanges([e])},L.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},L.getName=function(){return"WrappedSelection"},L.inspect=function(){return f(this)},L.detach=function(){this.anchorNode&&(l.getWindow(this.anchorNode)._rangySelection=null)},u.inspect=f,e.Selection=u,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var r=new this;n.call(r,e),r.base=function(){},delete Base._prototyping;var i=r.constructor,s=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],r)};return s.ancestor=this,s.extend=this.extend,s.forEach=this.forEach,s.implement=this.implement,s.prototype=r,s.toString=this.toString,s.valueOf=function(e){return"object"==e?s:i.valueOf()},n.call(s,t),"function"==typeof s.init&&s.init(),s},Base.prototype={extend:function(e,t){if(1<arguments.length){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var r=t.valueOf(),t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=r.apply(this,arguments);return this.base=e,t};t.valueOf=function(e){return"object"==e?t:r},t.toString=Base.toString}this[e]=t}else if(e){var i=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(i=this.extend||i);for(var s={toSource:null},o=["constructor","toString","valueOf"],u=Base._prototyping?0:1;a=o[u++];)e[a]!=s[a]&&i.call(this,a,e[a]);for(var a in e)s[a]||i.call(this,a,e[a])}return this}},Base=Base.extend({constructor:function(e){this.extend(e)}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)void 0===this.prototype[r]&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return""+this.valueOf()}}),wysihtml5.browser=function(){var e=navigator.userAgent,t=document.createElement("div"),n=-1!==e.indexOf("MSIE")&&-1===e.indexOf("Opera"),r=-1!==e.indexOf("Gecko")&&-1===e.indexOf("KHTML"),i=-1!==e.indexOf("AppleWebKit/"),s=-1!==e.indexOf("Opera/");return{USER_AGENT:e,supported:function(){var e=this.USER_AGENT.toLowerCase(),n="contentEditable"in t,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,i=document.querySelector&&document.querySelectorAll,e=-1!==e.indexOf("webkit")&&-1!==e.indexOf("mobile")||-1!==e.indexOf("opera mobi");return n&&r&&i&&!e},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!r},hasCurrentStyleProperty:function(){return"currentStyle"in t},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){var n;return(n="on"+e in t)||(t.setAttribute("on"+e,"return;"),n="function"==typeof t["on"+e]),n},supportsEventsInIframeCorrectly:function(){return!s},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return i||r},supportsDataTransfer:function(){try{return i&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(e){return!1}},supportsHTML5Tags:function(e){return e=e.createElement("div"),e.innerHTML="<article>foo</article>","<article>foo</article>"===e.innerHTML.toLowerCase()},supportsCommand:function(){var e={formatBlock:n,insertUnorderedList:n||s,insertOrderedList:n||s};return function(t,n){if(!e[n]){try{return t.queryCommandSupported(n)}catch(r){}try{return t.queryCommandEnabled(n)}catch(i){}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||s||i},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n||s},clearsListsInContentEditableCorrectly:function(){return r||n||i},autoScrollsToCaret:function(){return!i},autoClosesUnclosedTags:function(){var e=t.cloneNode(!1),n;return e.innerHTML="<p><div></div>",e=e.innerHTML.toLowerCase(),n="<p></p><div></div>"===e||"<p><div></div></p>"===e,this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return-1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in t},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(t){return 11<=(e.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange"in t||"speech"in t)},crashesWhenDefineProperty:function(e){return n&&("XMLHttpRequest"===e||"XDomainRequest"===e)}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return-1!==e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1},without:function(t){for(var t=wysihtml5.lang.array(t),n=[],r=0,i=e.length;r<i;r++)t.contains(e[r])||n.push(e[r]);return n},get:function(){for(var t=0,n=e.length,r=[];t<n;t++)r.push(e[t]);return r}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],r=0;r<n.length;r++)n[r].call(this,t);return this},stopObserving:function(e,t){this.events=this.events||{};var n=0,r,i;if(e){for(r=this.events[e]||[],i=[];n<r.length;n++)r[n]!==t&&i.push(r[n]);this.events[e]=i}else this.events={};return this}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(){var t={},n;for(n in e)t[n]=e[n];return t},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(n){return n=""+n,{trim:function(){return n.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)n=this.replace("#{"+t+"}").by(e[t]);return n},replace:function(e){return{by:function(t){return n.split(e).join(t)}}}}}}(),function(e){function t(e){return e.replace(i,function(e,t){var n=(t.match(s)||[])[1]||"",r=u[n],t=t.replace(s,"");t.split(r).length>t.split(n).length&&(t+=n,n="");var i=r=t;return t.length>o&&(i=i.substr(0,o)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+i+"</a>"+n})}function n(s){if(!r.contains(s.nodeName)){if(s.nodeType!==e.TEXT_NODE||!s.data.match(i)){o=e.lang.array(s.childNodes).get(),u=o.length;for(f=0;f<u;f++)n(o[f]);return s}var o=s.parentNode,u;u=o.ownerDocument;var f=u._wysihtml5_tempElement;f||(f=u._wysihtml5_tempElement=u.createElement("div")),u=f,u.innerHTML="<span></span>"+t(s.data);for(u.removeChild(u.firstChild);u.firstChild;)o.insertBefore(u.firstChild,s);o.removeChild(s)}}var r=e.lang.array("CODE,PRE,A,SCRIPT,HEAD,TITLE,STYLE".split(",")),i=/((https?:\/\/|www\.)[^\s<]{3,})/gi,s=/([^\w\/\-](,?))$/i,o=100,u={")":"(","]":"[","}":"{"};e.dom.autoLink=function(e){var t;e:{t=e;for(var i;t.parentNode;){t=t.parentNode,i=t.nodeName;if(r.contains(i)){t=!0;break e}if("body"===i)break}t=!1}return t?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),n(e))},e.dom.autoLink.URL_REG_EXP=i}(wysihtml5),function(e){var t=e.browser.supportsClassList(),n=e.dom;n.addClass=function(e,r){if(t)return e.classList.add(r);n.hasClass(e,r)||(e.className+=" "+r)},n.removeClass=function(e,n){if(t)return e.classList.remove(n);e.className=e.className.replace(RegExp("(^|\\s+)"+n+"(\\s+|$)")," ")},n.hasClass=function(e,n){if(t)return e.classList.contains(n);var r=e.className;return 0<r.length&&(r==n||RegExp("(^|\\s)"+n+"(\\s|$)").test(r))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;if(e.contains)return function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)};if(e.compareDocumentPosition)return function(e,t){return!!(e.compareDocumentPosition(t)&16)}}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}return function(t,n){if("UL"===t.nodeName||"OL"===t.nodeName||"MENU"===t.nodeName)return t;for(var r=t.ownerDocument,i=r.createElement(n),s=wysihtml5.lang.array(t.childNodes).get(),o=s.length,u,f,l,c,h=0;h<o;h++)c=c||e(r,i),u=s[h],f="block"===wysihtml5.dom.getStyle("display").from(u),l="BR"===u.nodeName,f?(c=c.firstChild?e(r,i):c,c.appendChild(u),c=null):l?c=c.firstChild?null:c:c.appendChild(u);return t.parentNode.replaceChild(i,t),i}}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var r,i=0,s=e.length;i<s;i++)r=e[i],t[r]&&(n[r]=t[r]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(n){for(var r=0,i=t.length;r<i;r++)if("border-box"===e.getStyle(t[r]).from(n))return t[r]};e.copyStyles=function(r){return{from:function(i){n(i)&&parseInt(e.getStyle("width").from(i),10)<i.offsetWidth&&(r=wysihtml5.lang.array(r).without(t));for(var s="",o=r.length,u=0,f;u<o;u++)f=r[u],s+=f+":"+e.getStyle(f).from(i)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,r,i){return e.dom.observe(t,r,function(r){for(var s=r.target,o=e.lang.array(t.querySelectorAll(n));s&&s!==t;){if(o.contains(s)){i.call(s,r);break}s=s.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e="abbr,article,aside,audio,bdi,canvas,command,datalist,details,figcaption,figure,footer,header,hgroup,keygen,mark,meter,nav,output,progress,rp,rt,ruby,svg,section,source,summary,time,track,video,wbr".split(",");return function(t,n){var n=n||document,r;if("object"==typeof t&&t.nodeType)r=n.createElement("div"),r.appendChild(t);else if(wysihtml5.browser.supportsHTML5Tags(n))r=n.createElement("div"),r.innerHTML=t;else{r=n;if(!r._wysihtml5_supportsHTML5Tags){for(var i=0,s=e.length;i<s;i++)r.createElement(e[i]);r._wysihtml5_supportsHTML5Tags=!0}r=n,i=r.createElement("div"),i.style.display="none",r.body.appendChild(i);try{i.innerHTML=t}catch(o){}r.body.removeChild(i),r=i}return r}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return!t||!t.length?!0:"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e)}return function(t,n,r){r=r||50;if(n.className||n.classRegExp)e:{for(var i=n.nodeName,s=n.className,n=n.classRegExp;r--&&t&&"BODY"!==t.nodeName;){var o;if(o=t.nodeType===wysihtml5.ELEMENT_NODE)if(o=e(t.nodeName,i)){o=s;var u=(t.className||"").match(n)||[];o=o?u[u.length-1]===o:!!u.length}if(o)break e;t=t.parentNode}t=null}else e:{i=n.nodeName;for(s=r;s--&&t&&"BODY"!==t.nodeName;){if(e(t.nodeName,i))break e;t=t.parentNode}t=null}return t}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(r){if(r.nodeType===wysihtml5.ELEMENT_NODE){var i=r.ownerDocument,s=t[n]||e(n),o=r.style,u=r.currentStyle,f=o[s];if(f)return f;if(u)return u[s];var s=i.defaultView||i.parentWindow,i=("height"===n||"width"===n)&&"TEXTAREA"===r.nodeName,l;if(s.getComputedStyle)return i&&(l=o.overflow,o.overflow="hidden"),r=s.getComputedStyle(r,null).getPropertyValue(n),i&&(o.overflow=l||""),r}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){var e={},t=1;return function(n,r){var i=(n._wysihtml5_identifier||(n._wysihtml5_identifier=t++))+":"+r,s=e[i];return s||(s=e[i]=n.getElementsByTagName(r)),0<s.length}}(),function(e){var t={},n=1;e.dom.hasElementWithClassName=function(r,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!r.querySelector("."+i);var s=(r._wysihtml5_identifier||(r._wysihtml5_identifier=n++))+":"+i,o=t[s];return o||(o=t[s]=r.getElementsByClassName(i)),0<o.length}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.head||t.getElementsByTagName("head")[0],r=t.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e)),n&&n.appendChild(r)}}},wysihtml5.dom.observe=function(e,t,n){for(var t="string"==typeof t?[t]:t,r,i,s=0,o=t.length;s<o;s++)i=t[s],e.addEventListener?e.addEventListener(i,n,!1):(r=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,r));return{stop:function(){for(var i,s=0,o=t.length;s<o;s++)i=t[s],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,r)}}},wysihtml5.dom.parse=function(){function e(t,i){var s=t.childNodes,o=s.length,u;u=n[t.nodeType];var a=0;u=u&&u(t);if(!u)return null;for(a=0;a<o;a++)(newChild=e(s[a],i))&&u.appendChild(newChild);return i&&1>=u.childNodes.length&&u.nodeName.toLowerCase()===r&&u.innerHTML!==wysihtml5.selection.PLACEHOLDER_TEXT&&!u.attributes.length?u.firstChild:u}function t(e,t){var t=t.toLowerCase(),n;if(n="IMG"==e.nodeName)if(n="src"==t){var r;try{r=e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(i){e.complete&&"complete"===e.readyState&&(r=!0)}n=!0===r}return n?e.src:u&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)}var n={1:function(e){var n,s,u=o.tags;s=e.nodeName.toLowerCase(),n=e.scopeName;if(e._wysihtml5)return null;e._wysihtml5=1,n&&"HTML"!=n&&(s=n+":"+s),"outerHTML"in e&&!wysihtml5.browser.autoClosesUnclosedTags()&&"P"===e.nodeName&&"</p>"!==e.outerHTML.slice(-4).toLowerCase()&&(s="div");if(s in u){n=u[s];if(!n||n.remove)return null;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:r}}s=e.ownerDocument.createElement(n.rename_tag||s);var u={},l=n.set_class,p=n.add_class,v=n.set_attributes,m=n.check_attributes,g=o.classes,y=0,b=[];n=[];var w=[],E=[],S;v&&(u=wysihtml5.lang.object(v).clone());if(m)for(S in m)if(v=a[m[S]])v=v(t(e,S)),"string"==typeof v&&(u[S]=v);l&&b.push(l);if(p)for(S in p)if(v=f[p[S]])l=v(t(e,S)),"string"==typeof l&&b.push(l);(E=e.getAttribute("class"))&&(b=b.concat(E.split(i)));for(p=b.length;y<p;y++)e=b[y],g[e]&&n.push(e);for(g=n.length;g--;)e=n[g],wysihtml5.lang.array(w).contains(e)||w.unshift(e);w.length&&(u["class"]=w.join(" "));for(S in u)try{s.setAttribute(S,u[S])}catch(x){}return u.src&&("undefined"!=typeof u.width&&s.setAttribute("width",u.width),"undefined"!=typeof u.height&&s.setAttribute("height",u.height)),s},3:function(e){return e.ownerDocument.createTextNode(e.data)}},r="span",i=/\s+/,s={tags:{},classes:{}},o={},u=!wysihtml5.browser.supportsGetAttributeCorrectly(),a={url:function(){var e=/^https?:\/\//i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return(t=(t||"").replace(e,""))||null}}()},f={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[(""+t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[(""+t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[(""+t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[(""+t).charAt(0)]}}()};return function(t,n,r,i){wysihtml5.lang.object(o).merge(s).merge(n).get();for(var r=r||t.ownerDocument||document,n=r.createDocumentFragment(),u="string"==typeof t,t=u?wysihtml5.dom.getAsDom(t,r):t;t.firstChild;)r=t.firstChild,t.removeChild(r),(r=e(r,i))&&n.appendChild(r);return t.innerHTML="",t.appendChild(n),u?wysihtml5.quirks.getCorrectInnerHTML(t):t}}(),wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t=wysihtml5.lang.array(e.childNodes).get(),n=t.length,r=0;r<n;r++)e=t[r],e.nodeType===wysihtml5.TEXT_NODE&&""===e.data&&e.parentNode.removeChild(e)},wysihtml5.dom.renameElement=function(e,t){for(var n=e.ownerDocument.createElement(t),r;r=e.firstChild;)n.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode)if(e.firstChild){for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}else e.parentNode.removeChild(e)},function(e){function t(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}e.resolveList=function(n){if("MENU"===n.nodeName||"UL"===n.nodeName||"OL"===n.nodeName){var r=n.ownerDocument.createDocumentFragment(),i=n.previousSibling,s,o,u;for(i&&"block"!==e.getStyle("display").from(i)&&t(r);u=n.firstChild;){for(s=u.lastChild;i=u.firstChild;)o=(o=i===s)&&"block"!==e.getStyle("display").from(i)&&"BR"!==i.nodeName,r.appendChild(i),o&&t(r);u.parentNode.removeChild(u)}n.parentNode.replaceChild(r,n)}}}(wysihtml5.dom),function(e){var t={uaCompatible:"IE=Edge"},n=document,r="parent,top,opener,frameElement,frames,localStorage,globalStorage,sessionStorage,indexedDB".split(","),i="open,close,openDialog,showModalDialog,alert,confirm,prompt,openDatabase,postMessage,XMLHttpRequest,XDomainRequest".split(","),s=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(n,r){this.callback=n||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(t).merge(r).get(),this.iframe=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=n.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var t=this,r=n.createElement("iframe");return r.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(r),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(r.src="javascript:'<html></html>'"),r.onload=function(){r.onreadystatechange=r.onload=null,t._onLoadIframe(r)},r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=r.onload=null,t._onLoadIframe(r))},r},_onLoadIframe:function(t){if(e.dom.contains(n.documentElement,t)){var o=this,u=t.contentWindow,l=t.contentDocument||t.contentWindow.document,t=this._getHtml({charset:n.characterSet||n.charset||"utf-8",stylesheets:this.config.stylesheets,uaCompatible:this.config.uaCompatible});l.open("text/html","replace"),l.write(t),l.close(),this.getWindow=function(){return u},this.getDocument=function(){return l},u.onerror=function(e,t,n){throw Error("wysihtml5.Sandbox: "+e,t,n)};if(!e.browser.supportsSandboxedIframes()){var c;for(t=0,c=r.length;t<c;t++)this._unset(u,r[t]);for(t=0,c=i.length;t<c;t++)this._unset(u,i[t],e.EMPTY_FUNCTION);for(t=0,c=s.length;t<c;t++)this._unset(l,s[t]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){o.callback(o)},0)}},_getHtml:function(t){var n=t.stylesheets,r="",i=0,s;if(n="string"==typeof n?[n]:n)for(s=n.length;i<s;i++)r+='<link rel="stylesheet" href="'+n[i]+'">';return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="#{uaCompatible}"><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,r,i){try{t[n]=r}catch(s){}try{t.__defineGetter__(n,function(){return r})}catch(o){}if(i)try{t.__defineSetter__(n,function(){})}catch(u){}if(!e.browser.crashesWhenDefineProperty(n))try{var f={get:function(){return r}};i&&(f.set=function(){}),Object.defineProperty(t,n,f)}catch(l){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var r in t)n.setAttribute(e[r]||r,t[r])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){t=t.style;if("string"==typeof e)t.cssText+=";"+e;else for(var n in e)"float"===n?(t.cssFloat=e[n],t.styleFloat=e[n]):t[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,n,r){var i=function(){n.hasPlaceholderSet()&&n.clear(),e.removeClass(n.element,"placeholder")},s=function(){n.isEmpty()&&(n.setValue(r),e.addClass(n.element,"placeholder"))};t.observe("set_placeholder",s).observe("unset_placeholder",i).observe("focus:composer",i).observe("paste:composer",i).observe("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){var e={"a u":wysihtml5.dom.replaceWithChildNodes};return function(t,n,r){var n=n||e,r=r||t.ownerDocument||document,i="string"==typeof t,s,o,u,f=0,t=i?wysihtml5.dom.getAsDom(t,r):t;for(u in n){s=t.querySelectorAll(u),r=n[u];for(o=s.length;f<o;f++)r(s[f])}return i?t.innerHTML:t}}(),function(e){var t=e.dom;e.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)e.innerHTML=""},0)};return function(n){t.observe(n,["cut","keydown"],e)}}(),e.quirks.ensureProperClearingOfLists=function(){var n=["OL","UL","MENU"];return function(r){t.observe(r,"keydown",function(i){i.keyCode===e.BACKSPACE_KEY&&(i=e.selection.getSelectedNode(r.ownerDocument),r.firstChild&&e.lang.array(n).contains(r.firstChild.nodeName)&&(i=t.getParentElement(i,{nodeName:n}))&&i==r.firstChild&&1>=i.childNodes.length&&(i.firstChild?""===i.firstChild.innerHTML:1)&&i.parentNode.removeChild(i))})}}()}(wysihtml5),function(e){e.quirks.getCorrectInnerHTML=function(t){var n=t.innerHTML;if(-1===n.indexOf("%7E"))return n;var t=t.querySelectorAll("[href*='~'], [src*='~']"),r,i,s,o;for(o=0,s=t.length;o<s;o++)r=t[o].href||t[o].src,i=e.lang.string(r).replace("~").by("%7E"),n=e.lang.string(n).replace(i).by(r);return n}}(wysihtml5),function(e){function t(t){var s=t.keyCode;if(!(t.shiftKey||s!==e.ENTER_KEY&&s!==e.BACKSPACE_KEY)){var o=t.target,u=e.selection.getSelectedNode(o.ownerDocument);(u=n.getParentElement(u,{nodeName:r},4))?"LI"===u.nodeName&&(s===e.ENTER_KEY||s===e.BACKSPACE_KEY)&&setTimeout(function(){var t=e.selection.getSelectedNode(o.ownerDocument);t&&!n.getParentElement(t,{nodeName:i},2)&&"P"===t.parentNode.nodeName&&(t=n.renameElement(t.parentNode,"div"),e.selection.selectNode(t))},0):s===e.ENTER_KEY&&(e.commands.exec(o,"insertLineBreak"),t.preventDefault())}}var n=e.dom,r="LI,DIV,P,H1,H2,H3,H4,H5,H6".split(","),i=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(e){n.observe(e.ownerDocument,"keydown",t)}}(wysihtml5),function(e){e.quirks.redraw=function(t){e.dom.addClass(t,"wysihtml5-quirks-redraw"),e.dom.removeClass(t,"wysihtml5-quirks-redraw");try{var n=t.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(e){function t(e){var t;return t=e._wysihtml5CaretPlaceholder=e._wysihtml5CaretPlaceholder||e.createElement("span"),e=t,e.innerHTML=r,e}function n(e){var n=t(e),r=i.getTextContent(n),s=e.getElementById(n.id),o=0;if(i.contains(e.body,n))return n;if(s)return s;n=e.getElementsByTagName("*");for(s=n.length;o<s;o++)if(e=n[o],e.innerHTML===r)return e;return null}var r="--_CARET_--",i=e.dom;e.selection={PLACEHOLDER_TEXT:r,getBookmark:function(e){return(e=this.getRange(e))&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(e.ownerDocument);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(e.ownerDocument);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t){var n=rangy.createRange(t.ownerDocument),r=t.nodeType===e.ELEMENT_NODE,s="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,o=r?t.innerHTML:t.data,o=""===o||o===e.INVISIBLE_SPACE,u=i.getStyle("display").from(t),u="block"===u||"list-item"===u;if(o&&r&&s)try{t.innerHTML=e.INVISIBLE_SPACE}catch(f){}s?n.selectNodeContents(t):n.selectNode(t),s&&o&&r?n.collapse(u):s&&o&&(n.setStartAfter(t),n.setEndAfter(t)),this.setSelection(n)},getSelectedNode:function(e,t){var n;return t&&e.selection&&"Control"===e.selection.type&&(n=e.selection.createRange())&&n.length?n.item(0):(n=this.getSelection(e),n.focusNode===n.anchorNode?n.focusNode:(n=this.getRange(e))?n.commonAncestorContainer:e.body)},executeAndRestore:function(e,r,i){if(!window.getSelection)return this.executeAndRestoreSimple(e,r);var s=e.body,o=s.scrollTop,u=s.scrollLeft,a=this.getRange(e),f=t(e);if(a){a.insertNode(f);try{r(a.startContainer,a.endContainer)}catch(l){setTimeout(function(){throw l},0)}if(r=n(e))e=rangy.createRange(e),e.selectNode(r),e.deleteContents(),this.setSelection(e);i&&(s.scrollTop=o,s.scrollLeft=u);try{r.parentNode.removeChild(r)}catch(h){}}else r(s,s)},executeAndRestoreSimple:function(e,t){var n,r,i=this.getRange(e),s,o;if(i){n=i.getNodes([3]),s=n[0]||i.startContainer,o=n[n.length-1]||i.endContainer,n=s===i.startContainer?i.startOffset:0,r=o===i.endContainer?i.endOffset:o.length;try{t(i.startContainer,i.endContainer)}catch(u){setTimeout(function(){throw u},0)}i=rangy.createRange(e);try{i.setStart(s,n)}catch(a){}try{i.setEnd(o,r)}catch(f){}try{this.setSelection(i)}catch(l){}}else t(e.body,e.body)},insertHTML:function(e,t){var n=rangy.createRange(e).createContextualFragment(t),r=n.lastChild;this.insertNode(n),r&&this.setAfter(r)},insertNode:function(e){var t=this.getRange(e.ownerDocument);if(!t)return!1;t.insertNode(e)},surround:function(e){var t=this.getRange(e.ownerDocument);if(t)try{t.surroundContents(e),this.selectNode(e)}catch(n){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(t){var n=t.ownerDocument,r=n.documentElement.scrollHeight>n.documentElement.offsetHeight,i;(i=n._wysihtml5ScrollIntoViewElement)||(i=n.createElement("span"),i.innerHTML=e.INVISIBLE_SPACE),n=n._wysihtml5ScrollIntoViewElement=i;if(r){this.insertNode(n),r=n,i=0;if(r.parentNode)do i+=r.offsetTop||0,r=r.offsetParent;while(r);r=i,n.parentNode.removeChild(n),r>t.scrollTop&&(t.scrollTop=r)}},selectLine:function(t){e.browser.supportsSelectionModify()?this._selectLine_W3C(t):t.selection&&this._selectLine_MSIE(t)},_selectLine_W3C:function(e){e=e.defaultView.getSelection(),e.modify("extend","left","lineboundary"),e.modify
("extend","right","lineboundary")},_selectLine_MSIE:function(e){var t=e.selection.createRange(),n=t.boundingTop,r=e.body.scrollWidth,i;if(t.moveToPoint){0===n&&(i=e.createElement("span"),this.insertNode(i),n=i.offsetTop,i.parentNode.removeChild(i)),n+=1;for(i=-10;i<r;i+=2)try{t.moveToPoint(i,n);break}catch(s){}for(e=e.selection.createRange();0<=r;r--)try{e.moveToPoint(r,n);break}catch(o){}t.setEndPoint("EndToEnd",e),t.select()}},getText:function(e){return(e=this.getSelection(e))?e.toString():""},getNodes:function(e,t,n){return(e=this.getRange(e))?e.getNodes([t],n):[]},getRange:function(e){return(e=this.getSelection(e))&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(e){return rangy.getSelection(e.defaultView||e.parentWindow)},setSelection:function(e){var t=(e.startContainer||e.endContainer).ownerDocument;return rangy.getSelection(t.defaultView||t.parentWindow).setSingleRange(e)}}}(wysihtml5),function(e,t){function n(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,r=e.attributes.length,i,s;n<r;++n)if(i=e.attributes[n],s=i.name,"class"!=s){s=t.attributes.getNamedItem(s);if(i.specified!=s.specified)return!1;if(i.specified&&i.nodeValue!==s.nodeValue)return!1}return!0}function r(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:0<n&&n<e.childNodes.length}function i(e,n,r){var s;t.dom.isCharacterDataNode(n)&&(0==r?(r=t.dom.getNodeIndex(n),n=n.parentNode):r==n.length?(r=t.dom.getNodeIndex(n)+1,n=n.parentNode):s=t.dom.splitDataNode(n,r));if(!s){s=n.cloneNode(!1),s.id&&s.removeAttribute("id");for(var o;o=n.childNodes[r];)s.appendChild(o);t.dom.insertAfter(s,n)}return n==e?s:i(e,s.parentNode,t.dom.getNodeIndex(s))}function s(t){this.firstTextNode=(this.isElementMerge=t.nodeType==e.ELEMENT_NODE)?t.lastChild:t,this.textNodes=[this.firstTextNode]}function o(e,t,n,r){this.tagNames=e||[u],this.cssClass=t||"",this.similarClassRegExp=n,this.normalize=r,this.applyToAnyTagName=!1}var u="span",a=/\s+/g;s.prototype={doMerge:function(){for(var e=[],t,n,r=0,i=this.textNodes.length;r<i;++r)t=this.textNodes[r],n=t.parentNode,e[r]=t.data,r&&(n.removeChild(t),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=e=e.join("")},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},o.prototype={getAncestorWithClass:function(n){for(var r;n;){if(this.cssClass)if(r=this.cssClass,n.className){var i=n.className.match(this.similarClassRegExp)||[];r=i[i.length-1]===r}else r=!1;else r=!0;if(n.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},postApply:function(e,t){for(var n=e[0],r=e[e.length-1],i=[],o,u=n,a=r,l=0,c=r.length,h,p,d=0,v=e.length;d<v;++d)(h=e[d],p=this.getAdjacentMergeableTextNode(h.parentNode,!1))?(o||(o=new s(p),i.push(o)),o.textNodes.push(h),h===n&&(u=o.firstTextNode,l=u.length),h===r&&(a=o.firstTextNode,c=o.getLength())):o=null;if(n=this.getAdjacentMergeableTextNode(r.parentNode,!0))o||(o=new s(r),i.push(o)),o.textNodes.push(n);if(i.length){for(d=0,v=i.length;d<v;++d)i[d].doMerge();t.setStart(u,l),t.setEnd(a,c)}},getAdjacentMergeableTextNode:function(t,n){var r=t.nodeType==e.TEXT_NODE,i=r?t.parentNode:t,s=n?"nextSibling":"previousSibling";if(r){if((r=t[s])&&r.nodeType==e.TEXT_NODE)return r}else if((r=i[s])&&this.areElementsMergeable(t,r))return r[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,r){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(r.tagName||"").toLowerCase())&&e.className.replace(a," ")==r.className.replace(a," ")&&n(e,r)},createContainer:function(e){return e=e.createElement(this.tagNames[0]),this.cssClass&&(e.className=this.cssClass),e},applyToTextNode:function(e){var n=e.parentNode;1==n.childNodes.length&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())?this.cssClass&&((e=this.cssClass,n.className)?(n.className&&(n.className=n.className.replace(this.similarClassRegExp,"")),n.className+=" "+e):n.className=e):(n=this.createContainer(t.dom.getDocument(e)),e.parentNode.insertBefore(n,e),n.appendChild(e))},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&e.lang.string(n.className).trim()==this.cssClass},undoToTextNode:function(e,t,n){t.containsNode(n)||(e=t.cloneRange(),e.selectNode(n),e.isPointInRange(t.endContainer,t.endOffset)&&r(t.endContainer,t.endOffset)&&(i(n,t.endContainer,t.endOffset),t.setEndAfter(n)),e.isPointInRange(t.startContainer,t.startOffset)&&r(t.startContainer,t.startOffset)&&(n=i(n,t.startContainer,t.startOffset))),this.similarClassRegExp&&n.className&&(n.className=n.className.replace(this.similarClassRegExp,""));if(this.isRemovable(n)){t=n;for(n=t.parentNode;t.firstChild;)n.insertBefore(t.firstChild,t);n.removeChild(t)}},applyToRange:function(t){var n=t.getNodes([e.TEXT_NODE]);if(!n.length)try{var r=this.createContainer(t.endContainer.ownerDocument);t.surroundContents(r),this.selectNode(t,r);return}catch(i){}t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE]);if(n.length){for(var s=0,o=n.length;s<o;++s)r=n[s],this.getAncestorWithClass(r)||this.applyToTextNode(r);t.setStart(n[0],0),r=n[n.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(n,t)}},undoToRange:function(t){var n=t.getNodes([e.TEXT_NODE]),r,i;n.length?(t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE])):(n=t.endContainer.ownerDocument.createTextNode(e.INVISIBLE_SPACE),t.insertNode(n),t.selectNode(n),n=[n]);for(var s=0,o=n.length;s<o;++s)r=n[s],(i=this.getAncestorWithClass(r))&&this.undoToTextNode(r,t,i);1==o?this.selectNode(t,n[0]):(t.setStart(n[0],0),r=n[n.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(n,t))},selectNode:function(t,n){var r=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,s=r?n.innerHTML:n.data;if((s=""===s||s===e.INVISIBLE_SPACE)&&r&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(o){}t.selectNodeContents(n),s&&r?t.collapse(!1):s&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var r=n.intersection(t),r=r?r.toString():"";return n.detach(),r},isAppliedToRange:function(t){var n=[],r,i=t.getNodes([e.TEXT_NODE]);if(!i.length)return(r=this.getAncestorWithClass(t.startContainer))?[r]:!1;for(var s=0,o=i.length,u;s<o;++s){u=this.getTextSelectedByRange(i[s],t),r=this.getAncestorWithClass(i[s]);if(""!=u&&!r)return!1;n.push(r)}return n},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=o}(wysihtml5,rangy),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.observe("beforeload",function(){e.parent.observe("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser,r=e.selection;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var n=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(n=this.parent.parse(n)),n=e.lang.string(n).replace(e.INVISIBLE_SPACE).by(""),n=e.lang.string(n).replace(r.PLACEHOLDER_TEXT).by("")},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.innerHTML=e},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var e=this.element.innerHTML;return""===e||e===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets,uaCompatible:"IE=7"}),this.iframe=this.sandbox.getIframe();var n=document.createElement("input");n.type="hidden",n.name="_wysihtml5_mode",n.value=1;var r=this.textarea.element;t.insert(this.iframe).after(r),t.insert(n).after(r)},_create:function(){var r=this;this.element=this.sandbox.getDocument().body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),window.rangy.init(),t.copyAttributes("className,spellcheck,title,lang,dir,accessKey".split(",")).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var i=this.config.name;i&&(t.addClass(this.element,i),t.addClass(this.iframe,i)),(i="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&t.simulatePlaceholder(this.parent,this,i),e.commands.exec(this.element,"styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){r.focus()},100),n.insertsLineBreaksOnReturn()||e.quirks.insertLineBreakOnReturn(this.element),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this.element),n.clearsListsInContentEditableCorrectly()||e.quirks.ensureProperClearingOfLists(this.element),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var i=n.canDisableAutoLinking(),s=n.doesAutoLinkingInContentEditable();i&&e.commands.exec(this.element,"autoUrlDetect",!1);if(this.config.autoLink){var o=this.sandbox.getDocument();(!s||s&&i)&&this.parent.observe("newword:composer",function(){r.executeAndRestore(o,function(e,n){t.autoLink(n.parentNode)})});var u=o.getElementsByTagName("a"),f=t.autoLink.URL_REG_EXP,l=function(n){return n=e.lang.string(t.getTextContent(n)).trim(),"www."===n.substr(0,4)&&(n="http://"+n),n};t.observe(this.element,"keydown",function(e){if(u.length){var e=r.getSelectedNode(e.target.ownerDocument),n=t.getParentElement(e,{nodeName:"A"},4),i;n&&(i=l(n),setTimeout(function(){var e=l(n);e!==i&&e.match(f)&&n.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){var r=["width","height"],i=r.length,s=this.element;e.commands.exec(s,"enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?n.supportsEvent("resizeend")&&t.observe(s,"resizeend",function(t){for(var t=t.target||t.srcElement,n=t.style,o=0,u;o<i;o++)u=r[o],n[u]&&(t.setAttribute(u,parseInt(n[u],10)),n[u]="");e.quirks.redraw(s)}):n.supportsEvent("resizestart")&&t.observe(s,"resizestart",function(e){e.preventDefault()})}})}(wysihtml5),function(e){var t=e.dom,n=document,r=window,i=n.createElement("div"),s="background-color,color,cursor,font-family,font-size,font-style,font-variant,font-weight,line-height,letter-spacing,text-align,text-decoration,text-indent,text-rendering,word-break,word-wrap,word-spacing".split(","),o="background-color,border-collapse,border-bottom-color,border-bottom-style,border-bottom-width,border-left-color,border-left-style,border-left-width,border-right-color,border-right-style,border-right-width,border-top-color,border-top-style,border-top-width,clear,display,float,margin-bottom,margin-left,margin-right,margin-top,outline-color,outline-offset,outline-width,outline-style,padding-left,padding-right,padding-top,padding-bottom,position,top,left,right,bottom,z-index,vertical-align,text-align,-webkit-box-sizing,-moz-box-sizing,-ms-box-sizing,box-sizing,-webkit-box-shadow,-moz-box-shadow,-ms-box-shadow,box-shadow,width,height".split(","),u="width,height,top,left,right,bottom".split(","),a=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],f=function(e){if(e.setActive)e.setActive();else{var i=e.style,s=n.documentElement.scrollTop||n.body.scrollTop,o=n.documentElement.scrollLeft||n.body.scrollLeft,i={position:i.position,top:i.top,left:i.left,WebkitUserSelect:i.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(i).on(e),r.scrollTo&&r.scrollTo(o,s)}};e.views.Composer.prototype.style=function(){var l=this,p=n.querySelector(":focus"),v=this.textarea.element,m=v.hasAttribute("placeholder"),g=m&&v.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||i.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||i.cloneNode(!1),m&&v.removeAttribute("placeholder"),v===p&&v.blur(),t.copyStyles(o).from(v).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(s).from(v).to(this.element).andTo(this.blurStylesHost),t.insertCSS(a).into(this.element.ownerDocument),f(v),t.copyStyles(o).from(v).to(this.focusStylesHost),t.copyStyles(s).from(v).to(this.focusStylesHost);var y=e.lang.array(o).without(["display"]);return p?p.focus():v.blur(),m&&v.setAttribute("placeholder",g),e.browser.hasCurrentStyleProperty()||t.observe(r,"resize",function(){var e=t.getStyle("display").from(v);v.style.display="",t.copyStyles(u).from(v).to(l.iframe).andTo(l.focusStylesHost).andTo(l.blurStylesHost),v.style.display=e}),this.parent.observe("focus:composer",function(){t.copyStyles(y).from(l.focusStylesHost).to(l.iframe),t.copyStyles(s).from(l.focusStylesHost).to(l.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(y).from(l.blurStylesHost).to(l.iframe),t.copyStyles(s).from(l.blurStylesHost).to(l.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,r={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var i=this,s=this.getValue(),o=this.sandbox.getIframe(),u=this.element,f=n.supportsEventsInIframeCorrectly()?u:this.sandbox.getWindow(),l=n.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];t.observe(o,"DOMNodeRemoved",function(){clearInterval(h),i.parent.fire("destroy:composer")});var h=setInterval(function(){t.contains(document.documentElement,o)||(clearInterval(h),i.parent.fire("destroy:composer"))},250);t.observe(f,"focus",function(){i.parent.fire("focus").fire("focus:composer"),setTimeout(function(){s=i.getValue()},0)}),t.observe(f,"blur",function(){s!==i.getValue()&&i.parent.fire("change").fire("change:composer"),i.parent.fire("blur").fire("blur:composer")}),t.observe(u,"dragenter",function(){i.parent.fire("unset_placeholder")}),n.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(u,["dragover","dragenter"],function(e){e.preventDefault()}),t.observe(u,l,function(t){var r=t.dataTransfer,s;r&&n.supportsDataTransfer()&&(s=r.getData("text/html")||r.getData("text/plain")),s?(u.focus(),e.commands.exec(u,"insertHTML",s),i.parent.fire("paste").fire("paste:composer"),t.stopPropagation(),t.preventDefault()):setTimeout(function(){i.parent.fire("paste").fire("paste:composer")},0)}),t.observe(u,"keyup",function(t){t=t.keyCode,(t===e.SPACE_KEY||t===e.ENTER_KEY)&&i.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){i.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(u,"mousedown",function(t){var n=t.target;"IMG"===n.nodeName&&(e.selection.selectNode(n),t.preventDefault())}),t.observe(u,"keydown",function(t){var n=r[t.keyCode];(t.ctrlKey||t.metaKey)&&n&&(e.commands.exec(u,n),t.preventDefault())}),t.observe(u,"keydown",function(t){var n=e.selection.getSelectedNode(u.ownerDocument,!0),r=t.keyCode;n&&"IMG"===n.nodeName&&(r===e.BACKSPACE_KEY||r===e.DELETE_KEY)&&(r=n.parentNode,r.removeChild(n),"A"===r.nodeName&&!r.firstChild&&r.parentNode.removeChild(r),setTimeout(function(){e.quirks.redraw(u)},0),t.preventDefault())});var p={IMG:"Image: ",A:"Link: "};t.observe(u,"mouseover",function(e){var e=e.target,t=e.nodeName;"A"!==t&&"IMG"!==t||(t=p[t]+(e.getAttribute("href")||e.getAttribute("src")),e.setAttribute("title",t))})}}(wysihtml5),function(e){e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var t,n=this,r=this.textarea.element.form,i=function(){t=setInterval(function(){n.fromComposerToTextarea()},400)},s=function(){clearInterval(t),t=null};i(),r&&(e.dom.observe(r,"submit",function(){n.sync(!0)}),e.dom.observe(r,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(e){"composer"===e&&!t?(n.fromTextareaToComposer(!0),i()):"textarea"===e&&(n.fromComposerToTextarea(!0),s())}),this.editor.observe("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value;return e&&!n||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.observe("beforeload",function(){wysihtml5.dom.observe(e,r,function(e){e=n[e.type]||e.type,t.fire(e).fire(e+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom;e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var n=this,r=function(e){var t=n._serialize();t==n.elementToChange?n.fire("edit",t):n.fire("save",t),n.hide(),e.preventDefault(),e.stopPropagation()};t.observe(n.link,"click",function(){t.hasClass(n.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){n.hide()},0)}),t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===e.ENTER_KEY&&r(t),i===e.ESCAPE_KEY&&n.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){n.fire("cancel"),n.hide(),e.preventDefault(),e.stopPropagation()});for(var i=this.container.querySelectorAll("input, select, textarea"),s=0,o=i.length,u=function(){clearInterval(n.interval)};s<o;s++)t.observe(i[s],"change",u);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),n=t.length,r=0;r<n;r++)e[t[r].getAttribute("data-wysihtml5-dialog-field")]=t[r].value;return e},_interpolate:function(){for(var e,t,n=document.querySelector(":focus"),r=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),i=r.length,s=0;s<i;s++)if(e=r[s],e!==n)t=e.getAttribute("data-wysihtml5-dialog-field"),t=this.elementToChange?this.elementToChange[t]||"":e.defaultValue,e.value=t},show:function(e){var n=this,r=this.container.querySelector("input, select, textarea");this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){n._interpolate()},500)),t.addClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="",this.fire("show");if(r&&!e)try{r.focus()}catch(i){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},r={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},s={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(o,u){var l=document.createElement("input");if(e.browser.supportsSpeechApiOn(l)){var h=document.createElement("div");e.lang.object(r).merge({width:u.offsetWidth+"px",height:u.offsetHeight+"px"}),t.insert(l).into(h),t.insert(h).into(u),t.setStyles(i).on(l),t.setAttributes(s).on(l),t.setStyles(r).on(h),t.setStyles(n).on(u),t.observe(l,"onwebkitspeechchange"in l?"webkitspeechchange":"speechchange",function(){o.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(u,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}else u.style.display="none"}}(wysihtml5),function(e){var t=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(t,n){this.editor=t,this.container="string"==typeof n?document.getElementById(n):n,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var r=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),i=r.length,s=0;s<i;s++)new e.toolbar.Speech(this,r[s])},_getLinks:function(t){for(var n=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("a[data-wysihtml5-"+t+"]")).get(),r=n.length,i=0,s=this[t+"Mapping"]={},o,u,f,l;i<r;i++)o=n[i],u=o.getAttribute("data-wysihtml5-"+t),f=o.getAttribute("data-wysihtml5-"+t+"-value"),l=this._getDialog(o,u),s[u+":"+f]={link:o,name:u,value:f,dialog:l,state:!1}},_getDialog:function(t,n){var r=this,i=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']"),s=this.composer.sandbox.getDocument(),o,u;return i&&(o=new e.toolbar.Dialog(t,i),o.observe("show",function(){u=e.selection.getBookmark(s),r.editor.fire("show:dialog",{command:n,dialogContainer:i,commandLink:t})}),o.observe("save",function(s){r.editor.focus(!1),u&&e.selection.setBookmark(u),r._execCommand(n,s),r.editor.fire("save:dialog",{command:n,dialogContainer:i,commandLink:t})}),o.observe("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:i,commandLink:t})})),o},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(t,n){this.editor.focus(!1),e.commands.exec(this.composer.element,t,n),this._updateLinkStates()},execAction:function(e){var t=this.editor;switch(e){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){for(var e=this,n=this.editor,r=this.container,i=this.commandLinks.concat(this.actionLinks),s=i.length,o=0;o<s;o++)t.setAttributes({href:"javascript:;",unselectable:"on"}).on(i[o]);t.delegate(r,"[data-wysihtml5-command]","mousedown",function(e){e.preventDefault()}),t.delegate(r,"[data-wysihtml5-command]","click",function(t){var n=t.target,r=n.getAttribute("data-wysihtml5-command"),n=n.getAttribute("data-wysihtml5-command-value");e.execCommand(r,n),t.preventDefault()}),t.delegate(r,"[data-wysihtml5-action]","click",function(t){var n=t.target.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),n.observe("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),n.observe("blur:composer",function(){clearInterval(e.interval)}),n.observe("destroy:composer",function(){clearInterval(e.interval)}),n.observe("change_view",function(n){setTimeout(function(){e.commandsDisabled="composer"!==n,e._updateLinkStates(),e.commandsDisabled?t.addClass(r,"wysihtml5-commands-disabled"):t.removeClass(r,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var n=this.composer.element,r=this.commandMapping,i,s,o;for(i in r)if(o=r[i],this.commandsDisabled?(s=!1,t.removeClass(o.link,"wysihtml5-command-active"),o.dialog&&o.dialog.hide()):(s=e.commands.state(n,o.name,o.value),e.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0),t.removeClass(o.link,"wysihtml5-command-disabled")),o.state!==s)(o.state=s)?(t.addClass(o.link,"wysihtml5-command-active"),o.dialog&&("object"==typeof s?o.dialog.show(s):o.dialog.hide())):(t.removeClass(o.link,"wysihtml5-command-active"),o.dialog&&o.dialog.hide())},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),wysihtml5.commands={support:function(e,t){return wysihtml5.browser.supportsCommand(e.ownerDocument,t)},exec:function(e,t,n){var r=this[t],i=r&&r.exec;if(i)return i.call(r,e,t,n);try{return e.ownerDocument.execCommand(t,!1,n)}catch(s){}},state:function(e,t,n){var r=this[t],i=r&&r.state;if(i)return i.call(r,e,t,n);try{return e.ownerDocument.queryCommandState(t)}catch(s){return!1}},value:function(e,t){var n=this[t];if(n=n&&n.value)n(e,t);else try{return e.ownerDocument.queryCommandValue(t)}catch(r){return null}}},function(e){e.commands.bold={exec:function(t,n){return e.commands.formatInline.exec(t,n,"b")},state:function(t,n){return e.commands.formatInline.state(t,n,"b")},value:function(){}}}(wysihtml5),function(e){function t(t,s){var o=t.ownerDocument,u="_wysihtml5-temp-"+(new Date).getTime(),f=0,l,c,h;e.commands.formatInline.exec(t,n,r,u,/non-matching-class/g),l=o.querySelectorAll(r+"."+u);for(u=l.length;f<u;f++)for(h in c=l[f],c.removeAttribute("class"),s)c.setAttribute(h,s[h]);f=c,1===u&&(h=i.getTextContent(c),u=!!c.querySelector("*"),h=""===h||h===e.INVISIBLE_SPACE,!u&&h&&(i.setTextContent(c,c.href),o=o.createTextNode(" "),e.selection.setAfter(c),e.selection.insertNode(o),f=o)),e.selection.setAfter(f)}var n,r="A",i=e.dom;e.commands.createLink={exec:function(n,r,s){var o=n.ownerDocument,u=this.state(n,r);u?e.selection.executeAndRestore(o,function(){for(var e=u.length,t=0,n,r,s;t<e;t++)n=u[t],r=i.getParentElement(n,{nodeName:"code"}),s=i.getTextContent(n),s.match(i.autoLink.URL_REG_EXP)&&!r?i.renameElement(n,"code"):i.replaceWithChildNodes(n)}):(s="object"==typeof s?s:{href:s},t(n,s))},state:function(t,n){return e.commands.formatInline.state(t,n,"A")},value:function(){return n}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[a-z]+/g;e.commands.fontSize={exec:function(n,r,i){return e.commands.formatInline.exec(n,r,"span","wysiwyg-font-size-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-font-size-"+i,t)},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-color-[a-z]+/g;e.commands.foreColor={exec:function(n,r,i){return e.commands.formatInline.exec(n,r,"span","wysiwyg-color-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-color-"+i,t)},value:function(){}}}(wysihtml5),function(e){function t(t){for(t=t.previousSibling;t&&t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim();)t=t.previousSibling;return t}function n(t){for(t=t.nextSibling;t&&t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim();)t=t.nextSibling;return t}function r(e){return"BR"===e.nodeName?!0:"block"===o.getStyle("display").from(e)?!0:!1}function i(t,n,r,i){if(i)var s=o.observe(t,"DOMNodeInserted",function(t){t=t.target,t.nodeType===e.ELEMENT_NODE&&"inline"!==o.getStyle("display").from(t).substr(0,6)&&(t.className+=" "+i)});t.execCommand(n,!1,r),s&&s.stop()}function s(e){u.selectLine(e.ownerDocument),u.surround(e);var r=n(e),i=t(e);r&&"BR"===r.nodeName&&r.parentNode.removeChild(r),i&&"BR"===i.nodeName&&i.parentNode.removeChild(i),(r=e.lastChild)&&"BR"===r.nodeName&&r.parentNode.removeChild(r),u.selectNode(e)}var o=e.dom,u=e.selection,a="H1,H2,H3,H4,H5,H6,P,BLOCKQUOTE,DIV".split(",");e.commands.formatBlock={exec:function(l,p,v,m,g){var y=l.ownerDocument,w=this.state(l,p,v,m,g),E,v="string"==typeof v?v.toUpperCase():v;if(w)u.executeAndRestoreSimple(y,function(){g&&(w.className=w.className.replace(g,""));var i=!!e.lang.string(w.className).trim();if(!i&&w.nodeName===(v||"DIV")){var i=w,s=i.ownerDocument,u=n(i),a=t(i);u&&!r(u)&&i.parentNode.insertBefore(s.createElement("br"),u),a&&!r(a)&&i.parentNode.insertBefore(s.createElement("br"),i),o.replaceWithChildNodes(w)}else i&&o.renameElement(w,"DIV")});else{if(null===v||e.lang.array(a).contains(v))if(E=u.getSelectedNode(y),w=o.getParentElement(E,{nodeName:a})){u.executeAndRestoreSimple(y,function(){v&&(w=o.renameElement(w,v));if(m){var e=w;e.className?(e.className=e.className.replace(g,""),e.className+=" "+m):e.className=m}});return}e.commands.support(l,p)?i(y,p,v||"DIV",m):(w=y.createElement(v||"DIV"),m&&(w.className=m),s(w))}},state:function(e,t,n,r,i){return n="string"==typeof n?n.toUpperCase():n,e=u.getSelectedNode(e.ownerDocument),o.getParentElement(e,{nodeName:n,className:r,classRegExp:i})},value:function(){}}}(wysihtml5),function(e){function t(t,i,s){var o=t+":"+i;if(!r[o]){var u=r,f=e.selection.HTMLApplier,l=n[t],t=l?[t.toLowerCase(),l.toLowerCase()]:[t.toLowerCase()];u[o]=new f(t,i,s,!0)}return r[o]}var n={strong:"b",em:"i",b:"strong",i:"em"},r={};e.commands.formatInline={exec:function(n,r,i,s,o){n=e.selection.getRange(n.ownerDocument);if(!n)return!1;t(i,s,o).toggleRange(n),e.selection.setSelection(n)},state:function(r,i,s,o,u){return r=r.ownerDocument,i=n[s]||s,!e.dom.hasElementWithTagName(r,s)&&!e.dom.hasElementWithTagName(r,i)?!1:o&&!e.dom.hasElementWithClassName(r,o)?!1:(r=e.selection.getRange(r),r?t(s,o,u).isAppliedToRange(r):!1)},value:function(){}}}(wysihtml5),function(e){e.commands.insertHTML={exec:function(t,n,r){e.commands.support(t,n)?t.ownerDocument.execCommand(n,!1,r):e.selection.insertHTML(t.ownerDocument,r)},state:function(){return!1},value:function(){}}}(wysihtml5),function(e){e.commands.insertImage={exec:function(t,n,r){var r="object"==typeof r?r:{src:r},i=t.ownerDocument,n=this.state(t),s;if(n)e.selection.setBefore(n),r=n.parentNode,r.removeChild(n),e.dom.removeEmptyTextNodes(r),"A"===r.nodeName&&!r.firstChild&&(e.selection.setAfter(r),r.parentNode.removeChild(r)),e.quirks.redraw(t);else{n=i.createElement("IMG");for(s in r)n[s]=r[s];e.selection.insertNode(n),e.selection.setAfter(n)}},state:function(t){var t=t.ownerDocument,n;return e.dom.hasElementWithTagName(t,"IMG")?(n=e.selection.getSelectedNode(t),n?"IMG"===n.nodeName?n:n.nodeType!==e.ELEMENT_NODE?!1:(n=e.selection.getText(t),(n=e.lang.string(n).trim())?!1:(t=e.selection.getNodes(t,e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==t.length?!1:t[0])):!1):!1},value:function(e){return(e=this.state(e))&&e.src}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,r){e.commands.support(n,r)?(n.ownerDocument.execCommand(r,!1,null),e.browser.autoScrollsToCaret()||e.selection.scrollIntoView(n)):e.commands.exec(n,"insertHTML",t)},state:function(){return!1},value:function(){}}}(wysihtml5),function(e){e.commands.insertOrderedList={exec:function(t,n){var r=t.ownerDocument,i,s,o;e.commands.support(t,n)?r.execCommand(n,!1,null):(i=e.selection.getSelectedNode(r),(o=e.dom.getParentElement(i,{nodeName:["UL","OL"]},4))?e.selection.executeAndRestoreSimple(r,function(){"OL"===o.nodeName?e.dom.resolveList
(o):("UL"===o.nodeName||"MENU"===o.nodeName)&&e.dom.renameElement(o,"ol")}):(s=r.createElement("span"),e.selection.surround(s),i=""===s.innerHTML||s.innerHTML===e.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(r,function(){o=e.dom.convertToList(s,"ol")}),i&&e.selection.selectNode(o.querySelector("li"))))},state:function(e,t){try{return e.ownerDocument.queryCommandState(t)}catch(n){return!1}},value:function(){}}}(wysihtml5),function(e){e.commands.insertUnorderedList={exec:function(t,n){var r=t.ownerDocument,i,s,o;e.commands.support(t,n)?r.execCommand(n,!1,null):(i=e.selection.getSelectedNode(r),(o=e.dom.getParentElement(i,{nodeName:["UL","OL"]}))?e.selection.executeAndRestoreSimple(r,function(){"UL"===o.nodeName?e.dom.resolveList(o):("OL"===o.nodeName||"MENU"===o.nodeName)&&e.dom.renameElement(o,"ul")}):(s=r.createElement("span"),e.selection.surround(s),i=""===s.innerHTML||s.innerHTML===e.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(r,function(){o=e.dom.convertToList(s,"ul")}),i&&e.selection.selectNode(o.querySelector("li"))))},state:function(e,t){try{return e.ownerDocument.queryCommandState(t)}catch(n){return!1}},value:function(){}}}(wysihtml5),function(e){e.commands.italic={exec:function(t,n){return e.commands.formatInline.exec(t,n,"i")},state:function(t,n){return e.commands.formatInline.state(t,n,"i")},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyCenter={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-center",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-center",t)},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyLeft={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-left",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-left",t)},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyRight={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-right",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-right",t)},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-text-decoration-underline/g;e.commands.underline={exec:function(n,r){return e.commands.formatInline.exec(n,r,"span","wysiwyg-text-decoration-underline",t)},state:function(n,r){return e.commands.formatInline.state(n,r,"span","wysiwyg-text-decoration-underline",t)},value:function(){}}}(wysihtml5),function(e){var t={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(n,r){this.textareaElement="string"==typeof n?document.getElementById(n):n,this.config=e.lang.object({}).merge(t).merge(r).get(),this.currentView=this.textarea=new e.views.Textarea(this,this.textareaElement,this.config);if(this._isCompatible=e.browser.supported()){e.dom.addClass(document.body,this.config.bodyClassName),this.currentView=this.composer=new e.views.Composer(this,this.textareaElement,this.config),"function"==typeof this.config.parser&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(i){}}else{var s=this;setTimeout(function(){s.fire("beforeload").fire("load")},0)}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var n=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&e.quirks.redraw(t),n},_initParser:function(){this.observe("paste:composer",function(){var t=this;e.selection.executeAndRestore(this.composer.sandbox.getDocument(),function(){e.quirks.cleanPastedHTML(t.composer.element),t.parse(t.composer.element)},!0)}),this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})}(wysihtml5);