// Generated by CoffeeScript 1.2.1-pre
(function(){$(window).load(function(){var e;return e={listing:function(){return $(".historique,.edit,.delete").tool_tip(1e3)}},e.listing()}),$(document).ready(function(){var e,t,n,r,i,s,o,u,a,f,l;return f={id_photo:"",init:function(){return $(".deleted_p_c").on("click",function(){var e,t,n,r;f.id_photo="#"+$(this).attr("id"),$(this).hasClass("photo_stock")&&(t="photo_stock"),$(this).hasClass("photo_user")&&(t="photo_user"),e=$(this).attr("id"),n=parseInt(e.replace(t+"_","")),$(this).hasClass("photo_stock")&&(r=$(this).parents(".left_area").next().children(".informations_card").children(".id_stock").val(),f.supp_photo_stock(n,r));if($(this).hasClass("photo_user"))return f.supp_photo_user(n)})},init_one_event:function(e){return $(e).on("click",function(){var e,t,n;return e=$(this).attr("id"),console.log(e),t=parseInt(e.replace("photo_stock_","")),n=$(this).parents(".left_area").next().children(".informations_card").children(".id_stock").val(),f.supp(t,n)})},supp_photo_user:function(e){var t;return t=new XMLHttpRequest,t.open("DELETE","/administration/users/"+$(".user_id").val()+"/delete_image/"+e),t.send(null),t.onreadystatechange=function(){if(t.readyState===t.DONE)return f.animation_supp(e)}},supp_photo_stock:function(e,t){var n;return n=new XMLHttpRequest,n.open("DELETE","/administration/users/"+$(".user_id").val()+"/stocks/"+t+"/delete_image/"+e),n.send(null),n.onreadystatechange=function(){if(n.readyState===n.DONE)return f.animation_supp()}},animation_supp:function(){var e;$(f.id_photo).hasClass("photo_stock")&&(e=$(f.id_photo).parents(".picture").parents("div.left_area"),$(f.id_photo).parents(".picture").remove(),f.regenerate_class(e));if($(f.id_photo).hasClass("photo_user"))return $(f.id_photo).parents(".is_small.has_corners_shadow").parents("li").remove()},regenerate_class:function(e){var t;return t=0,console.log(e),$(e).children(".picture").each(function(){var e;return e="",$(this).hasClass("is-editing")&&(e="is-editing "),$(this).removeClass($(this).attr("class")),t%2===0?e+="picture first_cloumn":e+="picture",$(this).addClass(e),t++})}},($(".photo_stock").length>0||$(".photo_user").length>0)&&f.init(),t={card:"",init:function(){return $(".add.button.image.add_user_image").on("click",function(){var e;return e=$(this).attr("id").replace("user_id_",""),t.card=$(this).parents("li").parents("ul"),console.log(t.card),t.generate_form(e)})},init_one_element:function(e){return $(e).on("click",function(){var e;return e=$(this).attr("id").replace("user_id_",""),t.card=$(this).parents("li").parents("ul"),t.generate_form(e)})},generate_form:function(e){var n,r,i,s,o,u,a,f,l,c;return window.light_box_information.html_content(""),u=$(document.createElement("form")),u.addClass("form-horizontal"),r={type_element:"input",label:{text:"Nouvelle photo"},input:{value:"",name:"photo_user[image]","class":"",id:"photo_user_image",other_attributes:[["type","file"]]}},s=window.global_functions.standard_input(r),i={type_element:"radio",label:{text:"First image"},input:{value:[[1,"Oui"],[0,"Non"]],name:"photo_user[first_image]","class":"photo_user_first_image",id:"photo_user_first_image_1",other_attributes:[["type","radio"]]}},o=window.global_functions.standard_input(i),l=$(document.createElement("span")),l.addClass("button"),n=$(document.createElement("a")),n.addClass("test"),n.text("Ajouter"),l.append(n),c=window.light_box_information.create_annuler(),u.append(s),u.append(o),window.light_box_information.html_footer(c),window.light_box_information.append_footer(l),window.light_box_information.header_html_content(""),window.light_box_information.append_content(u),window.light_box_information.show(),a=$(s).find("input"),f=$(o).find("input.photo_user_first_image"),l.on("click",function(){return t.upload_form(a,f,e)})},upload_form:function(e,n,r){var i,s,o,u,a;return i={},a=new XMLHttpRequest,a.open("POST","/administration/users/"+r+"/add_image"),o=new FormData,u=$(e).attr("name"),o.append($(n).attr("name"),$(n).filter(":checked").val()),console.log(e),s=e[0],console.log(e),console.log(s),o.append(u,s.files[0]),a.send(o),a.onreadystatechange=function(){if(a.readyState===a.DONE)return window.light_box_information.hide(),console.log(a.responseText),i=JSON.parse(a.responseText),t.create_photo(i.photo_user)}},create_photo:function(e){var n,r,i,s,o,u;s=$(document.createElement("li")),n=$(document.createElement("div")),n.addClass("is_small has_corners_shadow"),i=$(document.createElement("img")),i.attr("src",e.image.is_small.url),u=$(document.createElement("span")),u.addClass("deleted_p_c"),u.attr("id","photo_user_"+e.id),f.init_one_event(u),n.append(u),n.append(i),s.append(n),console.log(s),$(t.card).children("li").last().before(s);if(e.first_image===1)return o=$(t.card).children("li").last().prev().children("div"),r=$(t.card).parents(".pictures").children("div.has_corners_shadow.is_medium"),setTimeout(t.animation_first_image,200,r,o,e)},animation_first_image:function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g;return d=$(e).position(),v=$(n).position(),s=$(n).attr("class"),g=parseInt($(n).css("width")),a=parseInt($(n).css("height")),l=parseInt($(n).css("margin-left")),f=parseInt($(n).css("margin-bottom")),p=parseInt($(n).css("padding-top")),i=$(e).attr("class"),m=parseInt($(e).css("width")),u=parseInt($(e).css("height")),c=parseInt($(e).css("margin-top")),h=parseInt($(e).css("padding-top")),d.top+=c,console.log(v),d.top+=4,d.left-=3,o=$(document.createElement("div")),o.addClass(s),console.log(m),$(n).css("position","absolute"),$(n).css("top",v.top),$(n).css("left",v.left),$(n).css("z-index","10000"),$(n).after(o),console.log(r),$(n).children("img").attr("src",r.image.is_medium.url),$(n).animate({top:d.top+"px",left:d.left+"px",width:m+"px",height:u+"px",border:"1px solid #DCDCDC"},{duration:2e3,complete:function(){return $(this).removeClass($(this).attr("class")),$(this).addClass(i),$(this).css("position","relative"),$(this).css("top","0px"),$(this).css("left","0px"),$(e).before(this),$(this).remove,$(e).css("position","absolute"),$(e).removeClass("has_corners_shadow"),$(e).css("margin-top","Opx"),$(e).css("padding","Opx"),$(e).css("margin-left",l+"px"),$(e).css("margin-bottom",f+"px"),$(e).css("z-index","10000"),$(e).animate({top:v.top+"px",left:v.left+"px",width:g+"px",height:a+"px",padding:p+"px"},{duration:2e3,complete:function(){return $(this).removeClass($(this).attr("class")),$(this).addClass(s),$(this).css("position","relative"),$(this).css("top","0px"),$(this).css("left","0px"),console.log(o),o.remove(),$(t.card).children("li").last().prev().append(this),$(this).remove}})}})}},t.init(),e={card:"",init:function(){return $(".add.button.image.add_stock_image").on("click",function(){var t;return t=$(this).attr("id").replace("stock_id_",""),e.card=$(this).parents("div").parents("li.card"),e.generate_form(t)})},init_one_element:function(t){return $(t).on("click",function(){var t;return t=$(this).attr("id").replace("stock_id_",""),e.card=$(this).parents("div").parents("li.card"),e.generate_form(t)})},generate_form:function(t){var n,r,i,s,o,u,a,f,l,c;return window.light_box_information.html_content(""),u=$(document.createElement("form")),u.addClass("form-horizontal"),r={type_element:"input",label:{text:"Nouvelle photo"},input:{value:"",name:"photo_stock[image]","class":"",id:"photo_stock_image",other_attributes:[["type","file"]]}},s=window.global_functions.standard_input(r),i={type_element:"radio",label:{text:"First image"},input:{value:[[1,"Oui"],[0,"Non"]],name:"photo_stock[first_image]","class":"photo_stock_first_image",id:"photo_stock_first_image_1",other_attributes:[["type","radio"]]}},o=window.global_functions.standard_input(i),l=$(document.createElement("span")),l.addClass("button"),n=$(document.createElement("a")),n.addClass("test"),n.text("Ajouter"),l.append(n),c=window.light_box_information.create_annuler(),u.append(s),u.append(o),window.light_box_information.html_footer(c),window.light_box_information.append_footer(l),window.light_box_information.header_html_content(""),window.light_box_information.append_content(u),window.light_box_information.show(),a=$(s).find("input"),f=$(o).find("input.photo_stock_first_image"),l.on("click",function(){return e.upload_form(a,f,t)})},upload_form:function(t,n,r){var i,s,o,u,a;return i={},a=new XMLHttpRequest,a.open("POST","/administration/users/"+$(".user_id").val()+"/stocks/"+r+"/add_image"),o=new FormData,u=$(t).attr("name"),o.append($(n).attr("name"),$(n).filter(":checked").val()),console.log(t),s=t[0],console.log(t),console.log(s),o.append(u,s.files[0]),a.send(o),a.onreadystatechange=function(){if(a.readyState===a.DONE)return window.light_box_information.hide(),console.log(a.responseText),i=JSON.parse(a.responseText),e.create_photo(i.photo_stock)}},create_photo:function(t){var n,r,i,s,o,u;console.log(t),r=$(document.createElement("div")),s=$(e.card).children(".left_area").children(".picture").length,n="",s%2===0?n="picture first_cloumn":n="picture",r.addClass(n),i=$(document.createElement("img")),i.attr("src",t.image.is_small.url),u=$(document.createElement("span")),u.addClass("deleted_p_c"),u.attr("id","photo_stock_"+t.id),f.init_one_event(u),r.append(u),r.append(i),$(e.card).children(".left_area").children(".picture").length>0?$(e.card).children(".left_area").children(".picture").last().after(r):$(e.card).children(".left_area").children(".is_small.has_corners_shadow").after(r);if(t.first_image===1)return o=$(e.card).children(".left_area").children("div").last(),setTimeout(e.animation_first_image,200,$(e.card).children(".left_area").children(".is_small.has_corners_shadow"),o)},animation_first_image:function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;return h=$(t).position(),p=$(n).position(),r=$(n).attr("class"),v=parseInt($(n).css("width")),o=parseInt($(n).css("height")),a=parseInt($(n).css("margin-left")),u=parseInt($(n).css("margin-bottom")),c=parseInt($(n).css("padding-top")),d=parseInt($(t).css("width")),s=parseInt($(t).css("height")),f=parseInt($(t).css("margin-top")),l=parseInt($(t).css("padding-top")),h.top+=f,console.log(p),$(n).hasClass("first_cloumn")?(h.top+=4,h.left+=3):(h.top+=4,h.left-=3),i=$(document.createElement("div")),i.addClass(r),$(n).css("position","absolute"),$(n).css("top",p.top),$(n).css("left",p.left),$(n).css("z-index","10000"),$(n).after(i),$(n).animate({top:h.top+"px",left:h.left+"px",width:d+"px",height:s+"px",border:"1px solid #DCDCDC"},{duration:2e3,complete:function(){return $(this).removeClass($(this).attr("class")),$(this).addClass("is_small has_corners_shadow"),$(this).css("position","relative"),$(this).css("top","0px"),$(this).css("left","0px"),$(t).before(this),$(this).remove,$(t).css("position","absolute"),$(t).removeClass("has_corners_shadow"),$(t).css("margin-top","Opx"),$(t).css("padding","Opx"),$(t).css("margin-left",a+"px"),$(t).css("margin-bottom",u+"px"),$(t).css("z-index","10000"),$(t).css("border","3px solid #FFFFFF"),$(t).animate({top:p.top+"px",left:p.left+"px",width:v+"px",height:o+"px",padding:c+"px"},{duration:2e3,complete:function(){return $(this).removeClass($(this).attr("class")),$(this).addClass(r),$(this).css("position","relative"),$(this).css("top","0px"),$(this).css("left","0px"),console.log(i),i.remove(),$(e.card).children(".left_area").children("span").last().before(this),$(this).remove}})}})}},e.init(),r={actual_step:1,init:function(){return r.form_new_basket(),r.event(),r.info_panier_autorise($("#panier_panier_autorise_id").val())},re_init_form:function(){return r.actual_step=1,$(".etape_1").css("display","block"),$(".etape_3").css("display","none"),$(".title_1").css("display","block"),$(".title_3").css("display","none")},info_panier_autorise:function(e){var t;return t=$(".user_id").val(),$.ajax("/administration/users/"+t+"/panier_autorises/"+e,{type:"GET",async:!1,format:"json",success:function(e){return $("#panier_titre").val(e.titre),$("#panier_description").val(e.description),!0}}),!0},upload_form:function(){var e,t,n;return e={},n=new XMLHttpRequest,n.open("POST","/administration/users/"+$(".user_id").val()+"/paniers"),t=new FormData,$("#new_panier input, #new_panier textarea, #new_panier select").each(function(){var n,r;r=$(this).attr("name");if(e[r]===void 0&&$(this).attr("type")!=="button"&&$(this).attr("type")!=="file")return e[r]=$(this).val(),t.append(r,$(this).val());if($(this).attr("type")==="file")return n=document.querySelector("#"+$(this).attr("id")),t.append(r,n.files[0])}),n.send(t),n.onreadystatechange=function(){var e,t;if(n.readyState===n.DONE)return r.re_init_form(),window.lightbox_new_basket.hide(),console.log(n.responseText),e=n.responseText,t=$($(e)[0]),console.log(t),t.css({opacity:0,top:"-250px"}),console.log($(".card_stack:first-child")),$($(".card_stack")[0]).before(t),t.animate({opacity:1,top:"0px"},500)}},event:function(){return $("li.add.button").on("click",function(){return window.lightbox_new_basket.show()}),$(".next_step").on("click",function(){if(!r["error_step_"+i.actual_step]())return r.next_step()}),$(".previous_step").on("click",function(){return r.previous_step()}),$("#panier_panier_autorise_id").on("change",function(){return r.info_panier_autorise($(this).val())})},form_new_basket:function(){return window.lightbox_new_basket=new Lightbox(".lightbox_new_basket",".lightbox_form_new_basket")},verif_one_input:function(e){var t;return t=!1,$(e).val()===""?($(e).parents(".control-group").addClass("error"),t=!0):$(e).parents(".control-group").removeClass("error"),t},error_step_1:function(){var e;return e=!1,$(".etape_1 input, .etape_1 textarea").each(function(){if(r.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),e},error_step_2:function(){var e;return e=!1,$(".etape_2 input, .etape_2 textarea").each(function(){if(r.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),e},error_step_3:function(){var e;return e=!1,$(".etape_3 input,  .etape_3 textarea").each(function(){if(r.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),r.stock_is_depassed()&&(window.message_information.message_error(".title_3","erreur","Quantite en ligne excede celle du stock",2e3),e=!0),e},next_step:function(){var e;return r.actual_step===3?r.upload_form():($(".etape_"+r.actual_step).slideUp(500),$(".title_"+r.actual_step).css("display","none"),r.actual_step+=1,$(".etape_"+r.actual_step).slideDown(500),$(".title_"+r.actual_step).css("display","block"),e=$(".navigation>li>.current").parents("li").next().children("span"),$(".navigation>li>.current").removeClass("current"),console.log(e),e.addClass("current"))},previous_step:function(){var e;return $(".etape_"+r.actual_step).slideUp(500),$(".title_"+r.actual_step).css("display","none"),r.actual_step-=1,$(".etape_"+r.actual_step).slideDown(500),$(".title_"+r.actual_step).css("display","block"),e=$(".navigation>li>.current").parents("li").prev().children("span"),$(".navigation>li>.current").removeClass("current"),console.log(e),e.addClass("current")}},$(".card_stack").length>0&&r.init(),i={previous_id:"",exist_deja:!1,actual_step:1,init:function(){return i.init_select_stock(),i.form_new_stock(),i.event()},re_init_form:function(){return i.actual_step=1,$(".etape_1").css("display","block"),$(".etape_3").css("display","none"),$(".title_1").css("display","block"),$(".title_3").css("display","none")},init_select_stock:function(){var e;if(i.produit_deja_enstock($("#stock_produit_autorise_id").val())){e=!1,$("#stock_produit_autorise_id option").each(function(){var t;t=$(this).attr("value");if(!i.produit_deja_enstock(t))return e=!0,$("#stock_produit_autorise_id").val(t),i.info_produit_autorise(t)});if(!e)return alert("Tous les produits autorisé sont en stock")}},upload_form:function(){var t,n,r;return t={},r=new XMLHttpRequest,r.open("POST","/administration/users/"+$(".user_id").val()+"/stocks"),n=new FormData,$("#new_stock input, #new_stock textarea, #new_stock select").each(function(){var e,r;r=$(this).attr("name");if(t[r]===void 0&&$(this).attr("type")!=="button"&&$(this).attr("type")!=="file")return t[r]=$(this).val(),n.append(r,$(this).val());if($(this).attr("type")==="file")return e=document.querySelector("#"+$(this).attr("id")),n.append(r,e.files[0])}),r.send(n),r.onreadystatechange=function(){var t,n;if(r.readyState===r.DONE)return i.re_init_form(),window.lightbox_new_stock.hide(),console.log(r.responseText),t=r.responseText,n=$($(t)[0]),n.css({opacity:0,top:"-250px"}),$("ul.cards").prepend(n),l.event_one_element(n.find(".buttons_card li.delete")),e.init_one_element(n.find(".add.button.image")),u.one_edit_button(n.find(".buttons_card>.edit")),s.init_one_card(n),n.animate({opacity:1,top:"0px"},500)},console.log(t)},event:function(){return $(".buttons>li.add").on("click",function(){return window.lightbox_new_stock.show()}),$("#new_stock").bind("ajax:complete",function(e,t){var n,r;return i.re_init_form(),window.lightbox_new_stock.hide(),n=t.responseText,r=$($(n)[0]),r.css({opacity:0,top:"-250px"}),$("ul.cards").prepend(r),l.event_one_element(r.find(".buttons_card li.delete")),r.animate({opacity:1,top:"0px"},500)}),$(".next_step").on("click",function(){if(!i["error_step_"+i.actual_step]())return i.next_step()}),$(".previous_step").on("click",function(){return i.previous_step()}),$(".formulaire_add input,.formulaire_add textarea").on("change",function(){return i.verif_one_input(this)}),$("#produit_vente_libre_quantite").on("change",function(){if(i.stock_is_depassed())return window.message_information.message_error(".title_3","erreur","Quantite en ligne excede celle du stock",2e3)}),$("#produit_vente_libre_nombre_pack").on("change",function(){if(i.stock_is_depassed())return window.message_information.message_error(".title_3","erreur","Quantite en ligne excede celle du stock",2e3)}),$("#stock_produit_autorise_id").on("click",function(){return i.previous_id=$(this).val()}),$("#stock_produit_autorise_id").on("change",function(){return i.produit_deja_enstock($(this).val())?(alert("Deja dans le stock"),$(this).val(i.previous_id)):i.info_produit_autorise($(this).val())})},info_produit_autorise:function(e){var t;return t=$(".user_id").val(),$.ajax("/administration/users/"+t+"/produit_autorises/"+e,{type:"GET",async:!1,format:"json",success:function(e){return $("#stock_titre").val(e.titre),$("#stock_description").val(e.description),!0}}),!0},produit_deja_enstock:function(e){var t;return t=$(".user_id").val(),$.ajax("/administration/users/"+t+"/exist_stock/"+e,{type:"GET",async:!1,format:"json",success:function(e){return i.exist_deja=e,!0}}),i.exist_deja},form_new_stock:function(){return window.lightbox_new_stock=new Lightbox(".lightbox_new_stock",".lightbox_form_new_stock")},stock_is_depassed:function(){var e,t,n,r;return $("#produit_vente_libre_quantite").val()===""||$("#produit_vente_libre_nombre_pack").val()===""?!1:(t=parseInt($("#produit_vente_libre_quantite").val()),e=parseInt($("#produit_vente_libre_nombre_pack").val()),r=parseInt($("#stock_quantite").val()),n=r-e*t,n>=0?!1:!0)},verif_one_input:function(e){var t;return t=!1,$(e).val()===""?($(e).parents(".control-group").addClass("error"),t=!0):$(e).parents(".control-group").removeClass("error"),t},error_step_1:function(){var e;return e=!1,$(".etape_1 input, .etape_1 textarea").each(function(){if(i.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),e},error_step_2:function(){var e;return e=!1,$(".etape_2 input, .etape_2 textarea").each(function(){if(i.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),e},error_step_3:function(){var e;return e=!1,$(".etape_3 input,  .etape_3 textarea").each(function(){if(i.verif_one_input(this))return e=!0}),e&&window.message_information.message_error(".title_3","erreur","Certain champ sont vides",2e3),i.stock_is_depassed()&&(window.message_information.message_error(".title_3","erreur","Quantite en ligne excede celle du stock",2e3),e=!0),e},next_step:function(){var e;return i.actual_step===3?i.upload_form():($(".etape_"+i.actual_step).slideUp(500),$(".title_"+i.actual_step).css("display","none"),i.actual_step+=1,$(".etape_"+i.actual_step).slideDown(500),$(".title_"+i.actual_step).css("display","block"),e=$(".navigation>li>.current").parents("li").next().children("span"),$(".navigation>li>.current").removeClass("current"),console.log(e),e.addClass("current"))},previous_step:function(){var e;return $(".etape_"+i.actual_step).slideUp(500),$(".title_"+i.actual_step).css("display","none"),i.actual_step-=1,$(".etape_"+i.actual_step).slideDown(500),$(".title_"+i.actual_step).css("display","block"),e=$(".navigation>li>.current").parents("li").prev().children("span"),$(".navigation>li>.current").removeClass("current"),console.log(e),e.addClass("current")}},console.log($(".cards")),$("ul.cards").length>0&&i.init(),l={init:function(){return $(".buttons_card li.delete").on("click",function(){var e,t,n;return e=$(this).attr("id").replace("stock_id_",""),n=$(".user_id").val(),t=this,l.have_confirmation(n,e,t)})},"delete":function(e,t,n){return $.ajax({type:"DELETE",url:"/administration/users/"+e+"/stocks/"+t,format:"json",complete:function(e){var t;return t=$(n).parents("li.card"),t.removeClass("in"),t.css("top","0px"),t.animate({opacity:0,top:"-270px"},{duration:500,complete:function(){return $(this).remove()}})}})},have_confirmation:function(e,t,n){var r,i,s;return window.light_box_information.html_content("<p> Etes vous sur ? </p>"),window.light_box_information.title_header("Confirmation"),s=window.light_box_information.create_annuler(),window.light_box_information.html_footer(s),i=$(document.createElement("span")),i.addClass("button"),r=$(document.createElement("a")),r.text("Oui"),i.append(r),window.light_box_information.append_footer(i),window.light_box_information.show(),i.on("click",function(){return window.light_box_information.hide(),l["delete"](e,t,n)})},event_one_element:function(e){return $(e).on("click",function(){var e,t,n;return e=$(this).attr("id").replace("stock_id_",""),n=$(".user_id").val(),t=this,t=this,l.have_confirmation(n,e,t)})}},l.init(),u={init:function(){return u.edit_button(),u.help_button(),u.event_close(),u.stats_button()},heigth_help_div:"0px",event_close:function(){return $(".helper>.close").on("click",function(){return u.close_help(".buttons>li.help")})},stats_button:function(){if($(".buttons>li.stats").length>0)return $(".buttons>li.stats").on("click",function(){return $(this).hasClass("button_active")?($(this).removeClass("button_active"),window.statisitques.hide(),window.statisitques.clear_stats()):($(this).addClass("button_active"),window.statisitques.show(),window.statisitques.init())})},help_button:function(){if($(".buttons>li.help").length>0)return u.heigth_help_div=$(".helper").css("height"),$(".buttons>li.help").on("click",function(){return $(this).hasClass("button_active")?u.close_help(this):u.show_help(this)})},close_help:function(e){return $(e).removeClass("button_active"),$(".helper").animate({opacity:0},{duration:500,complete:function(){return $(this).slideUp(500,function(){return $(this).addClass("helper_close")})}})},show_help:function(e){return $(e).addClass("button_active"),$(".helper").removeClass("helper_close"),$(".helper").slideDown(500,function(){return $(this).animate({opacity:1},{duration:500})})},one_edit_button:function(e){$(".buttons>li.edit").length>0&&$(".buttons>li.edit").on("click",function(){return $(this).hasClass("button_active")?($(this).removeClass("button_active"),u.remove_editing_class()):($(this).addClass("button_active"),u.add_editing_class())});if($(".buttons_card").length>0)return $(e).on("click",function(){if($(this).hasClass("button_active")){$(this).removeClass("button_active"),$(".cards").length>0&&u.remove_editing_class($(this).parents("li.card"));if($(".card_stack").length>0)return u.remove_editing_class($(this).parents("div.card_stack"))}else{$(this).addClass("button_active"),$(".cards").length>0&&u.add_editing_class($(this).parents("li.card"));if($(".card_stack").length>0)return u.add_editing_class($(this).parents("div.card_stack"))}})},edit_button:function(){$(".buttons>li.edit").length>0&&$(".buttons>li.edit").on("click",function(){return $(this).hasClass("button_active")?($(this).removeClass("button_active"),u.remove_editing_class()):($(this).addClass("button_active"),u.add_editing_class())});if($(".buttons_card").length>0)return $(".buttons_card>.edit").on("click",function(){if($(this).hasClass("button_active")){$(this).removeClass("button_active"),$(".cards").length>0&&u.remove_editing_class($(this).parents("li.card"));if($(".card_stack").length>0)return u.remove_editing_class($(this).parents("div.card_stack"))}else{$(this).addClass("button_active"),$(".cards").length>0&&u.add_editing_class($(this).parents("li.card"));if($(".card_stack").length>0)return u.add_editing_class($(this).parents("div.card_stack"))}})},remove_editing_class:function(e){e==null&&(e="body"),$(".user_profile").length>0&&($(".user_profile>.content>p").removeClass("is-editing"),$(".user_profile>.pictures>div").removeClass("is-editing")),$(".cards").length>0&&($(e).children(".right_area").children(".header").children(".title").removeClass("is-editing"),$(e).children(".right_area").children(".body").children(".description").removeClass("is-editing"),$(e).children(".right_area").children(".footer").children("ul").children("li").removeClass("is-editing"),$(e).children(".left_area").children(".has_corners_shadow").removeClass("is-editing"),$(e).children(".left_area").children(".picture").removeClass("is-editing"));if($(".card_stack").length>0)return $(e).children(".packaging").children(".header").children(".title").removeClass("is-editing"),$(e).children(".packaging").children(".body").children(".description").removeClass("is-editing"),$(e).children(".packaging").children(".footer").children("ul").removeClass("is-editing"),$(e).children(".packaging").children(".footer").children("ul.details").removeClass("is-editing"),$(e).children(".packaging").children(".footer").children("ul.main-informations").children("li").removeClass("is-editing")},add_editing_class:function(e){e==null&&(e="body"),$(".user_profile").length>0&&($(".user_profile>.content>p").addClass("is-editing"),$(".user_profile>.pictures>ul>li>div.is_small").addClass("is-editing")),$(".cards").length>0&&(console.log($(e).children(".rigth_area")),$(e).children(".right_area").children(".header").children(".title").addClass("is-editing"),$(e).children(".right_area").children(".body").children(".description").addClass("is-editing"),$(e).children(".right_area").children(".footer").children("ul").children("li").addClass("is-editing"),$(e).children(".left_area").children(".has_corners_shadow").addClass("is-editing"),$(e).children(".left_area").children(".picture").addClass("is-editing"));if($(".card_stack").length>0)return $(e).children(".packaging").children(".header").children("span").children(".title").addClass("is-editing"),$(e).children(".packaging").children(".body").children("span").children(".description").addClass("is-editing"),$(e).children(".packaging").children(".footer").children("ul.details").addClass("is-editing"),$(e).children(".packaging").children(".footer").children("ul.main-informations").children("li").addClass("is-editing")}},u.init(),$("div.card_stack>.packaging h2.title").form_plugin({champ:"titre",element:{type:"input"},button:{"class":"update_titre",text_update:"Modifier le titre"},url_get_infos:["user","panier"]}),$("div.card_stack>.packaging p.description").form_plugin({champ:"description",element:{type:"input"},button:{"class":"update_description",text_update:"Modifier le description"},url_get_infos:["user","panier"]}),n={panier_id:0,div_list:$(""),div_form:$(""),div_sous_content:$(""),init:function(){return $("div.card_stack>.packaging ul.details").on("click",function(){if($(this).hasClass("is-editing"))return n.generate_box(),n.add_select(),n.panier_id=$(this).parents("div.footer").prevAll("div.informations_card").children(".id_panier").val(),n.get_panier()})},get_panier:function(){var e,t;return e={},t=new XMLHttpRequest,t.open("GET","/administration/users/"+$(".user_id").val()+"/paniers/"+n.panier_id),t.setRequestHeader("Accept","application/json"),t.send(null),t.onreadystatechange=function(){var r,i,s,o;if(t.readyState===t.DONE){e=JSON.parse(t.responseText),console.log(e),i=e.panier.nb_pack_total,o=e.declinaison_panier;for(r in o)s=o[r],n.div_list.append(n.create_fiche_declinaison(s));return $(".header-list>p   ").text(i+" declinaisons")}}},li_detail:function(e){var t,n,r,i,s,o,u;r=$(document.createElement("li")),r.addClass("detail"),s=$(document.createElement("span")),s.addClass("label"),s.text(e.label),e.value.element==="span"&&(n=$(document.createElement("span")),n.addClass("number"),n.text(e.value.value));if(e.value.element==="ul"){n=$(document.createElement("ul")),n.addClass("number"),u=e.value.value;for(t in u)o=u[t],i=$(document.createElement("li")),o===e.value.check&&i.addClass("check"),i.text(o),n.append(i)}return r.append(s),r.append(n),r},create_fiche_declinaison:function(e){var t,r,i,s,o,u,a;return i=$(document.createElement("div")),i.addClass("raw"),a=$(document.createElement("ul")),a.addClass("details"),u=n.li_detail({label:"Max",value:{element:"span",value:e.nb_pack}}),o=n.li_detail({label:"Format",value:{element:"ul",value:[2,4,6],check:e.nombre_personne}}),s=n.li_detail({label:"Duree",value:{element:"ul",value:[3,6,9],check:e.duree}}),a.append(u),a.append(o),a.append(s),r=$(document.createElement("div")),r.addClass("close_square"),t=$(document.createElement("div")),t.addClass("clear"),i.append(a),i.append(r),i.append(t),i},generate_box:function(){var e;return window.light_box_information.html_content(""),n.div_sous_content=$(document.createElement("div")),n.div_sous_content.addClass("sous_content"),n.div_sous_content.append(n.header_list()),n.div_list=$(document.createElement("div")),n.div_list.addClass("embosed-list basket-details"),n.div_sous_content.append(n.div_list),window.light_box_information.append_content(n.div_sous_content),window.light_box_information.title_header("titre"),e=window.light_box_information.create_annuler(),window.light_box_information.html_footer(e),window.light_box_information.show()},header_list:function(){var e,t,r,i,s,o;return r=$(document.createElement("div")),r.addClass("header-list"),i=$(document.createElement("p")),i.text("18 déclinaisons"),s=$(document.createElement("span")),s.addClass("button new-declinaision button_declinaion"),e=$(document.createElement("a")),e.text("nouvelle"),s.append(e),e.on("click",function(){return n.animate_for_form(1e3)}),o=$(document.createElement("span")),o.addClass("back-declinaison button_declinaion"),o.text("retour"),o.on("click",function(){return n.animate_for_tab(1e3)}),t=$(document.createElement("div")),t.addClass("clear"),r.append(i),r.append(s),r.append(o),r.append(t),r},animate_for_tab:function(e){return n.div_sous_content.animate({"margin-left":"0px"})},animate_for_form:function(e){return n.div_sous_content.animate({"margin-left":"-600px"})},add_select:function(){var e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m;t=$(document.createElement("div")),t.addClass("form_add_decli"),t.css("float","right"),t.css("display","block"),p=$(document.createElement("p")),u=$(document.createElement("label")),u.text("Nombre mis en ligne : "),i=$(document.createElement("input")),i.attr("name","panier[nb_pack]"),p.append(u),p.append(i),h=$(document.createElement("p")),o=$(document.createElement("label")),o.text("Nombre de personne : "),v=$(document.createElement("select")),v.attr("name","panier[nombre_personne]"),l=[2,4,6],r=0;while(l.length>r)a=$(document.createElement("option")),a.val(l[r]),a.text(l[r]),v.append(a),r++;h.append(o),h.append(v),c=$(document.createElement("p")),s=$(document.createElement("label")),s.text("Duree (mois) : "),d=$(document.createElement("select")),d.attr("name","panier[duree]"),f=[3,6,9],r=0;while(f.length>r)a=$(document.createElement("option")),a.val(f[r]),a.text(f[r]),d.append(a),r++;return c.append(s),c.append(d),m=$(document.createElement("span")),e=$(document.createElement("a")),e.text("Ajoutez"),m.addClass("button"),e.on("click",function(){var e;return e={nb_pack:i.val(),nombre_personne:v.val(),duree:d.val()},n.add_declinaison(e)}),m.append(e),t.append(h),t.append(c),t.append(p),t.append(m),n.div_form=t,n.div_sous_content.prepend(t)},add_declinaison:function(e){var t,r;return r=new XMLHttpRequest,r.open("POST","/administration/users/"+$(".user_id").val()+"/paniers/create_declinaison"
),r.setRequestHeader("Accept","application/json"),t=new FormData,t.append("panier[id]",n.panier_id),t.append("panier[nb_pack]",e.nb_pack),t.append("panier[nombre_personne]",e.nombre_personne),t.append("panier[duree]",e.duree),r.send(t),r.onreadystatechange=function(){var t;if(r.readyState===r.DONE)return console.log(r.responseText),t=JSON.parse(r.responseText),t.status==="error"?window.message_information.message_error(".lightbox_wrapper .header","erreur",t.error,5e3):window.light_box_information.append_content(n.create_fiche_declinaison(e))}}},n.init(),o={panier_id:"",init:function(){return $("div.card_stack>.packaging ul.main-informations>.product_number").on("click",function(){if($(this).hasClass("is-editing"))return o.panier_id=$(this).parents("div.footer").prevAll("div.informations_card").children(".id_panier").val(),o.all_product()})},all_product:function(){var e;return e=new XMLHttpRequest,e.open("GET","/administration/users/"+$(".user_id").val()+"/paniers/"+o.panier_id+"/get_all_product"),e.send(null),e.onreadystatechange=function(){var t;if(e.readyState===e.DONE)return console.log(e.responseText),t=e.responseText,window.light_box_information.title_header("Produits du panier"),window.light_box_information.html_content(""),window.light_box_information.append_content(t),o.button_add_product(),window.light_box_information.show()}},button_add_product:function(){var e;return e=window.global_functions.standard_button({link:{text:"Form add",event:[{type:"click",callback:[o.get_own_stock]}]}}),window.light_box_information.append_content(e)},form_add_product:function(e){var t,n,r,i,s,u,a,f;f=[];for(n in e)a=e[n],r={value:a.id,text:a.titre},f.push(r);return i=window.global_functions.standard_input({type_element:"select",label:{text:"Produit"},input:{value:"",options:f,name:"","class":"",id:""}}),i.find("select").on("change",function(){return o.verif_stock($(this).val())}),s=window.global_functions.standard_input({type_element:"input",label:{text:"Quantite"},input:{value:"",name:"","class":"",id:""}}),t=window.global_functions.standard_button({link:{text:"Ajoutez nouveau produit",event:[{type:"click",callback:[o.get_own_stock]}]}}),u=$(document.createElement("form")),u.addClass("form-horizontal"),u.append(i),u.append(s),u.append(t),window.light_box_information.append_content(u)},verif_stock:function(e){var t,n;return n=new XMLHttpRequest,n.open("POST","/administration/users/"+$(".user_id").val()+"/paniers/"+o.panier_id+"/produit_stock_already_in"),n.setRequestHeader("Accept","application/json"),t=new FormData,t.append("stock_id",e),n.send(t),n.onreadystatechange=function(){var e;if(n.readyState===n.DONE){e=JSON.parse(n.responseText);if(e.status==="error")return window.message_information.message_error(".lightbox_wrapper .header","erreur",e.error,5e3)}}},get_own_stock:function(){var e;return e=new XMLHttpRequest,e.open("GET","/administration/users/"+$(".user_id").val()+"/stocks/"),e.setRequestHeader("Accept","application/json"),e.send(null),e.onreadystatechange=function(){var t;if(e.readyState===e.DONE){t=JSON.parse(e.responseText);if(t.status==="OK")return console.log(e.responseText),o.form_add_product(t.stock)}}},fiche_product:function(){}},o.init(),$(".user_profile .content>.title").form_plugin({url_get_infos:["user"],champ:"prenom, nom",titre:"Modifier le prenom et le nom",element:{type:"input"},button:{"class":"update_prenom",text_update:"Modifier"}}),$.ajax({type:"GET",url:"/villes/index",format:"json",complete:function(e){var t,n,r,i,s,o;r=$.parseJSON(e.responseText),n=[],s=[],o=r.ville;for(t in o)i=o[t],n.push(i.id),s.push(i.cp+" - "+i.nom);return $(".user_profile .content>.city").form_plugin({url_get_infos:["user"],champ:"ville_id",titre:"La ville",element:{type:"select",options:{value:n,text:s}},button:{"class":"update_ville",text_update:"Modifier la ville"}}).bind("end_form_plugin",function(){})}}),$(".user_profile .content>.description").form_plugin({url_get_infos:["user"],champ:"description",titre:"La description",element:{type:"textarea"},button:{"class":"update_description",text_update:"Modifier la description"}}),$(".user_profile .content>.address").form_plugin({url_get_infos:["user"],champ:"adresse",titre:"L'adresse",element:{type:"input"},button:{"class":"update_adresse",text_update:"Modifier l'adresse"}}),$(".user_profile .content>.phone").form_plugin({url_get_infos:["user"],champ:"telephone",titre:"Le telephone",element:{type:"input"},button:{"class":"update_telephone",text_update:"Modifier le telephone"}}),$(".user_profile .content>.email").form_plugin({url_get_infos:["user"],champ:"email",titre:"L'email",element:{type:"input"},button:{"class":"update_email",text_update:"Modifier l'email"}}),s={init:function(){return $(".card h2.title").form_plugin({champ:"titre",titre:"Le titre",element:{type:"input"},button:{"class":"update_titre",text_update:"Modifier le titre"},url_get_infos:["user","stock"],url_to_update:["user","stock"]}),$(".card p.description").form_plugin({url_get_infos:["user","stock"],champ:"description",titre:"La description",element:{type:"textarea"},button:{"class":"update_description",text_update:"Modifier la description"}}),$(".card li.prix").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],champ:"prix_unite_ttc",titre:"Le prix",element:{type:"input"},button:{"class":"update_prix",text_update:"Modifier le prix"}}).bind("end_form_plugin",function(){return $(this).append(" €")}),$.ajax({type:"POST",url:"/administration/users/"+$("input.user_id").val()+"/get_unite_mesure",format:"json",complete:function(e){var t,n,r,i,s;r=$.parseJSON(e.responseText),n=[],s=[];for(t in r)i=r[t],n.push(i.id),s.push(i.nom);return $(".card li.unite_mesure").form_plugin({url_get_infos:["user","stock"],champ:"unite_mesure_id",titre:"L'unite de mesure",element:{type:"select",options:{value:n,text:s}},button:{"class":"update_unite_mesure",text_update:"Modifier l'unite de mesure"}}).bind("end_form_plugin",function(){return $(".info_unite_mesure_id").text("("+$(this).children("span.value").text()+")")})}}),$(".card li.quantite_lot").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],titre:"quantite d'un lot",champ:"quantite",element:{type:"input"},button:{"class":"update_quantite",text_update:"Modifier la quantite"}}).bind("end_form_plugin",function(){var e,t,n,r,i;return i=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),r="/administration/users/"+i+"/stocks/"+e,t=$(this).parents("ul").children("li.nombre_pack").children("span.value"),n=this,$.ajax({type:"GET",url:r,format:"json",success:function(e){var r;return t.text(e.produit_vente_libre.nombre_pack+" / "+e.produit_vente_libre.lot_possible_max+" ( possible )"),r=$(document.createElement("span")),r.addClass("is_italic info_unite_mesure_id"),r.text(" ("+e.unite_mesure.nom+")"),$(n).append(r)}})}),$(".card li.nombre_pack").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],titre:"nombre de lot",champ:"nombre_pack",element:{type:"input"},button:{"class":"update_nombre_pack",text_update:"Modifier le nombre de lot"}}).bind("end_form_plugin",function(){var e,t,n,r;return r=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),n="/administration/users/"+r+"/stocks/"+e,t=this,$.ajax({type:"GET",url:n,format:"json",success:function(e){return $(t).children("span.value").append(" /"+e.produit_vente_libre.lot_possible_max+" ( possible )")}})}),$(".card li.stock_total").form_plugin({url_get_infos:["user","stock"],champ:"quantite",titre:"Le stock total",element:{type:"input"},button:{"class":"update_quantite_stock",text_update:"Modifier le stock total"}}).bind("end_form_plugin",function(){var e,t,n,r,i;return i=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),r="/administration/users/"+i+"/stocks/"+e,t=$(this).parents("ul").children("li.nombre_pack").children("span.value"),n=this,$.ajax({type:"GET",url:r,format:"json",success:function(e){var r;return t.text(e.produit_vente_libre.nombre_pack+" / "+e.produit_vente_libre.lot_possible_max+"( possible )"),r=$(document.createElement("span")),r.addClass("is_italic info_unite_mesure_id"),r.text(" ("+e.unite_mesure.nom+")"),$(n).append(r)}})})},init_one_card:function(e){return $(e).find("h2.title").form_plugin({champ:"titre",titre:"Le titre",element:{type:"input"},button:{"class":"update_titre",text_update:"Modifier le titre"},url_get_infos:["user","stock"],url_to_update:["user","stock"]}),$(e).find("p.description").form_plugin({url_get_infos:["user","stock"],champ:"description",titre:"La description",element:{type:"textarea"},button:{"class":"update_description",text_update:"Modifier la description"}}),$(e).find("li.prix").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],champ:"prix_unite_ttc",titre:"Le prix",element:{type:"input"},button:{"class":"update_prix",text_update:"Modifier le prix"}}).bind("end_form_plugin",function(){return $(this).append(" €")}),$.ajax({type:"POST",url:"/administration/users/"+$("input.user_id").val()+"/get_unite_mesure",format:"json",complete:function(t){var n,r,i,s,o;i=$.parseJSON(t.responseText),r=[],o=[];for(n in i)s=i[n],r.push(s.id),o.push(s.nom);return $(e).find("li.unite_mesure").form_plugin({url_get_infos:["user","stock"],champ:"unite_mesure_id",titre:"L'unite de mesure",element:{type:"select",options:{value:r,text:o}},button:{"class":"update_unite_mesure",text_update:"Modifier l'unite de mesure"}}).bind("end_form_plugin",function(){return $(".info_unite_mesure_id").text("("+$(this).children("span.value").text()+")")})}}),$(e).find("li.quantite_lot").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],titre:"quantite d'un lot",champ:"quantite",element:{type:"input"},button:{"class":"update_quantite",text_update:"Modifier la quantite"}}).bind("end_form_plugin",function(){var e,t,n,r,i;return i=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),r="/administration/users/"+i+"/stocks/"+e,t=$(this).parents("ul").children("li.nombre_pack").children("span.value"),n=this,$.ajax({type:"GET",url:r,format:"json",success:function(e){var r;return t.text(e.produit_vente_libre.nombre_pack+" / "+e.produit_vente_libre.lot_possible_max+" ( possible )"),r=$(document.createElement("span")),r.addClass("is_italic info_unite_mesure_id"),r.text(" ("+e.unite_mesure.nom+")"),$(n).append(r)}})}),$(e).find("li.nombre_pack").form_plugin({url_get_infos:["user","stock"],url_to_update:["user","produit_vente_libre"],titre:"nombre de lot",champ:"nombre_pack",element:{type:"input"},button:{"class":"update_nombre_pack",text_update:"Modifier le nombre de lot"}}).bind("end_form_plugin",function(){var e,t,n,r;return r=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),n="/administration/users/"+r+"/stocks/"+e,t=this,$.ajax({type:"GET",url:n,format:"json",success:function(e){return $(t).children("span.value").append(" /"+e.produit_vente_libre.lot_possible_max+" ( possible )")}})}),$(e).find("li.stock_total").form_plugin({url_get_infos:["user","stock"],champ:"quantite",titre:"Le stock total",element:{type:"input"},button:{"class":"update_quantite_stock",text_update:"Modifier le stock total"}}).bind("end_form_plugin",function(){var e,t,n,r,i;return i=$("input.user_id").val(),e=$(this).parents("div").prevAll("div.informations_card").children("input.id_stock").val(),r="/administration/users/"+i+"/stocks/"+e,t=$(this).parents("ul").children("li.nombre_pack").children("span.value"),n=this,$.ajax({type:"GET",url:r,format:"json",success:function(e){var r;return t.text(e.produit_vente_libre.nombre_pack+" / "+e.produit_vente_libre.lot_possible_max+"( possible )"),r=$(document.createElement("span")),r.addClass("is_italic info_unite_mesure_id"),r.text(" ("+e.unite_mesure.nom+")"),$(n).append(r)}})})}},s.init(),a={hover_action:function(){return $(".subnav").each(function(){if(!$(this).hasClass("subnav_isopen"))return $(this).css({"margin-top":"-105px",position:"relative",opacity:0,"z-index":1})}),$(".pannels>li").css({position:"relative","z-index":2}),$("li.stock").bind("click",function(){return $(".subnav").hasClass("subnav_isopen")?($(".subnav").animate({marginTop:"-105px",opacity:0},1e3),$(".subnav").removeClass("subnav_isopen")):($(".subnav").animate({marginTop:"0px",opacity:1},1e3),$(".subnav").addClass("subnav_isopen"))})}},a.hover_action()})}).call(this);