// Generated by CoffeeScript 1.2.1-pre
(function(){$(document).ready(function(){var e,t,n,r;return e={id_user:$(".button-add").attr("id").replace("user_",""),init:function(){return this.evenement_button()},evenement_button:function(){return $(".button-add").bind("ajax:complete",function(t,r){var i;i=n.all_produit_en_vente();if(i.all_deja_vente!==!0)return $("#light_box").html(r.responseText),e.evenement_form(i.stock_id),$("#light_box").modal("show");if($(".alert-error").length===0)return message_information.message_error(".button-add","Erreur","Tous les produits du stock sont déjà en vente",2e3)})},evenement_form:function(t){var i;return $("#produit_vente_libre_stock_id").val(t),n.info_stock(t),i=0,$("#produit_vente_libre_stock_id").focus(function(){return i=$(this).val()}).change(function(){var e;return e=$("#produit_vente_libre_stock_id option:selected").text(),n.produit_deja_envente($(this).val())?($(this).val(i),message_information.message_error("#produit_vente_libre_stock_id","Erreur",e+" est déjà en vente",2e3)):n.info_stock($(this).val())}),$(".etape_3 input").change(function(){var e;return e="#"+$(this).attr("id"),r.verif_one_input(e)}),$("#produit_vente_libre_quantite, #produit_vente_libre_nombre_pack").change(function(){return e.verif_quantite()}),$("#new_produit_vente_libre").submit(function(){var t,n;return t=r.verif_all_input(".etape_active",".form-inputs"),n=e.verif_quantite(),t||n?!1:!0}),$(".form-actions .next").click(function(){return e.next_step()}),$(".form-actions .previous").click(function(){return e.previous_step()}),$(".simple_form").bind("ajax:loading",function(e,t){return alert(t),$("#light_box").html('<div class="progress progress-striped"> <div class="bar" style="width:20%"> </div></div>')}),$(".simple_form").bind("ajax:complete",function(e,t){return $("#light_box").modal("hide")})},verif_quantite:function(){var e,t,r,i;if(!!isNaN(parseInt($("#produit_vente_libre_quantite").val()))||!!isNaN(parseInt($("#produit_vente_libre_nombre_pack").val())))return!1;t=parseInt($("#produit_vente_libre_quantite").val()),e=parseInt($("#produit_vente_libre_nombre_pack").val()),r=n.quantite_stock($("#produit_vente_libre_stock_id").val()),i=r-e*t,console.log(i);if(!(i<0))return $("div").hasClass("info_reste_quantite")?message_information.message_success(".alert-info","Infos","Il vous restera "+i+" "+$("#unite_mesure_stock").text()+" dans votre stock ",2e3,"info_reste_quantite"):message_information.message_success(".alert-info","Infos","Il vous restera "+i+" "+$("#unite_mesure_stock").text()+" dans votre stock ",2e3,"info_reste_quantite"),!1;if(!$("div").hasClass("error_quantite"))return message_information.message_error(".alert-info","Erreur","La quantite mis en ligne excede celle du stock ",2e3,"error_quantite"),!0},next_step:function(){var e,t,n,r;for(n=r=0;r<=5;n=++r)$(".etape_active").hasClass("etape_"+n)&&(e="etape_"+n,console.log(e),$(".etape_formulaire").hasClass("etape_"+(n+1))&&(t="etape_"+(n+1)));return $("."+e).slideUp("5000"),$("."+t).slideDown("5000"),$("."+t).addClass("etape_active"),$("."+e).removeClass("etape_active")},previous_step:function(){var e,t,n,r;for(n=r=0;r<=5;n=++r)$(".etape_active").hasClass("etape_"+n)&&(e="etape_"+n,console.log(e),$(".etape_formulaire").hasClass("etape_"+(n-1))&&(t="etape_"+(n-1)));return $("."+e).slideUp("5000"),$("."+t).slideDown("5000"),$("."+t).addClass("etape_active"),$("."+e).removeClass("etape_active")}},t={id_user:$(".button-add").attr("id").replace("user_",""),id_product:0,id_stock:0,quantity_stock:0,event:function(){return $(".modifier_product").bind("ajax:complete",function(e,r){var i,s;return i=$(this).attr("id").replace("produit_vente_libre_",""),s=n.info_product(i),t.init_var(s.stock.quantite,i,s.stock.id),$("#light_box").html(r.responseText),$("#light_box").modal("show"),t.event_form()})},init_var:function(e,n,r){return t.quantity_stock=e,t.id_product=n,t.id_stock=r},event_form:function(){return $("#produit_vente_libre_quantite, #produit_vente_libre_nombre_pack").change(function(){return t.verif_quantite()}),$(".edit_produit_vente_libre input").bind("change",function(){var e;return e="#"+$(this).attr("id"),r.verif_one_input(e)}),$(".edit_produit_vente_libre .envoi_form").bind("click",function(){return r.verif_all_input(".edit_produit_vente_libre",".edit_produit_vente_libre .alert-info")?!1:!0}),$(".edit_produit_vente_libre").bind("ajax:complete",function(e,t){return $("#light_box").html(""),$("#light_box").modal("hide")})},verif_quantite:function(){var e,n,r,i;if(!isNaN(parseInt($(".modif_formulaire #produit_vente_libre_quantite").val()))&&!isNaN(parseInt($(".modif_formulaire #produit_vente_libre_nombre_pack").val()))){r=parseInt($(".modif_formulaire #produit_vente_libre_quantite").val()),n=parseInt($(".modif_formulaire #produit_vente_libre_nombre_pack").val()),i=t.quantity_stock-n*r;if(i<0){if(!$("div").hasClass("error_quantite"))return message_information.message_error(".alert-info","Erreur","La quantite mis en ligne excede celle du stock ",2e3,"error_quantite"),!0}else e="Il vous restera "+i+" "+$("#unite_mesure_stock").text()+" dans votre stock ",message_information.message_success(".alert-info","Infos",e,2e3,"info_reste_quantite");return!1}return!1}},r={verif_one_input:function(e){var t;return t=!1,$(e).hasClass("required")&&$(e).val()===""&&(div_state.div_warning($(e),"Ne peut pas être vide"),t=!0),t===!1&&$(e).attr("type")==="number"&&(isNaN(parseInt($(e).val()))&&$(e).val()!==""?(div_state.div_warning($(e),"Ce n'est pas un nombre"),t=!0):div_state.div_success($(e),"")),t},verif_all_input:function(e,t){var n;return n=!1,$(e+" input").each(function(){r.verif_one_input("#"+$(this).attr("id"))===!0&&(n=!0);if(n===!0&&!$("div").hasClass("all_error"))return message_information.message_error(t,"Erreur","Corrigé vos erreur",2e3,"all_error")}),n}},t.event(),n={all_produit_en_vente:function(){var t;return t={},$.ajax("/administration/users/"+e.id_user+"/all_exist_vente",{type:"GET",async:!1,format:"json",success:function(e){return t=e,!0}}),t},produit_deja_envente:function(t){var n;return n=!1,$.ajax("/administration/users/"+e.id_user+"/one_exist_vente/"+t,{type:"GET",async:!1,format:"json",success:function(e){return n=e,!0}}),n},info_product:function(t){var n;return n={},$.ajax("/administration/users/"+e.id_user+"/produit_vente_libres/"+t,{type:"GET",async:!1,format:"json",success:function(e){return n=e}}),n},info_stock:function(t){return $.ajax("/administration/users/"+e.id_user+"/stocks/"+t,{type:"GET",async:!1,format:"json",success:function(e){return $("#produit_vente_libre_titre").val(e[0].titre),$("#produit_vente_libre_description").val(e[0].description),$("#quantite_stock").text(e[0].quantite),$("#unite_mesure_stock").text(e[1].abbreviation),!1}}),!0},quantite_stock:function(e){var t;return t=0,$.ajax("/administration/users/"+id_user+"/stocks/"+e,{type:"GET",async:!1,format:"json",success:function(e){return t=parseInt(e[0].quantite)}}),t}},e.init()})}).call(this);