(function(){$.fn.form_plugin=function(e){var t,n,r,i,s,o,u,a,f,l;i={user_id:$("input.user_id").val(),table_get_infos:"",table_to_update:"",champ:[],titre:(o=e.titre)!=null?o:"Titre",id_entite_get_infos:"",id_entite_update:"",element:{type:(u=e["element"]["type"])!=null?u:"input",options:{value:e.element.options!==void 0?e.element.options.value:[],text:e.element.options!==void 0?e.element.options.text:[]}},"class":"string optional",button:{"class":e.button!==void 0?(a=e["button"]["class"])!=null?a:"update_element":"update_element",text_update:e.button!==void 0?(f=e["button"]["text_update"])!=null?f:"Modifier":"Modifier"},callback:(l=e.callback)!=null?l:null},n=e.champ.split(",");for(t in n)s=n[t],i.champ.push($.trim(s));return r={input_create:[],show_form:function(e){var n,s,o,u,a,f,l;n={hidden_input:{balise:"input",id:i.table_to_update+"_id",value:e[i.table_to_update].id,size:"50",type_input:"hidden",name:i.table+"[id]"},link:{"class":i.button["class"],text:i.button.text_update},input:[]},l=i.champ;for(t in l){f=l[t],s={balise:i.element.type,id:i.table_to_update+"_"+f,value:e[i.table_to_update][f],size:"50",type_input:"text",name:i.table_to_update+"["+f+"]","class":"string optional",option:[]},n.input.push(s);if(s.balise==="select"){n.input[t].option=[],a=0,u=[];while(a<i.element.options.value.length)o={value:i.element.options.value[a],text:i.element.options.text[a]},n.input[t].option.push(o),a++}}return r.generate_form(n),window.light_box_information.show()},generate_form:function(e){var n,o,u,a,f,l,c,h,p,d,v,m,g,y,b;window.light_box_information.html_content(""),window.light_box_information.header_html_content(""),a=$(document.createElement(e.hidden_input.balise)),a.attr("id",e.hidden_input.id),a.attr("name",e.hidden_input.name),a.val(e.hidden_input.value),a.attr("type",e.hidden_input.type_input),a.addClass(e.hidden_input["class"]),r.input_create=[],u=$(document.createElement("form")),u.addClass("form-horizontal"),b=e.input;for(t in b)s=b[t],o={type_element:s.balise,label:{text:i.titre},input:{value:s.value,name:s.name,"class":s["class"],id:s.id,other_attributes:[]}},s.balise==="input"?(o.input.other_attributes.push(["type",s.type_input]),o.input.other_attributes.push(["size",s.size])):s.balise==="textarea"?o.input.other_attributes.push(["cols",s.size]):s.balise==="select"&&(o.input.options=s.option),f=window.global_functions.standard_input(o),u.append(f),r.input_create.push(f.find(s.balise));return window.light_box_information.append_content(u),window.light_box_information.append_content(a),e.span_infos&&(y=$(document.createElement("span")),y.text(e.span_infos.text),window.light_box_information.append_content(y)),m=$(document.createElement("span")),m.addClass("button"),n=$(document.createElement("a")),n.addClass(e.link["class"]),n.text(e.link.text),m.append(n),g=window.light_box_information.create_annuler(),p=$(".lightbox_wrapper.lightbox_information .form-horizontal .controls").position(),c=$(".lightbox_wrapper.lightbox_information").css("margin-left"),h=$(".lightbox_wrapper.lightbox_information").css("margin-top"),l=$(".lightbox_wrapper.lightbox_information .form-horizontal .control-group").css("margin-bottom"),console.log(l),v=$(".lightbox_wrapper.lightbox_information .content").css("padding-left"),d=$(".lightbox_wrapper.lightbox_information .content").css("padding-top"),i.left+=p.left-parseInt(c)-parseInt(d)-10,i.top-=parseInt(h)+parseInt(v)-parseInt(l),window.light_box_information.css({margin:"Opx",top:i.top+"px",left:i.left+"px",position:"absolute"}),window.light_box_information.html_footer(g),window.light_box_information.append_footer(m),m.on("click",function(){return r.update_information(this)})},get_information:function(){var e;return e=$("input.user_id").val(),$.ajax({type:"GET",url:i.the_url_get_infos,format:"json",complete:function(e){var t;return t=$.parseJSON(e.responseText),t.status==="OK"?t:alert(t.error)}})},update_information:function(e){var n,o,u,a,f,l,c,h;a=$("input.user_id").val(),l="",c=r.input_create,h=[];for(t in c)s=c[t],u=i.table_to_update,o=i.id_entite_update,t=i.champ[t],f=$(s).val(),n={},n[u]={},n[u][t]=f,l+=" "+f,f!==""?h.push($.ajax({type:"PUT",url:i.the_url_to_update,data:n,format:"json",complete:function(e){var t,n;return n=$.parseJSON(e.responseText),n.status==="OK"?($(i.element_clicked).children("span.value").length>0?t=$(i.element_clicked).children("span.value"):$(i.element_clicked).children("span.number").length>0?t=$(i.element_clicked).children("span.number"):t=i.element_clicked,i.element.type==="select"?$(t).text($(s).children("option[value='"+f+"']").text()):$(t).text($.trim(l)),window.light_box_information.hide(),$(i.element_clicked).trigger("end_form_plugin")):window.message_information.message_error("input#"+$(s).attr("id"),"erreur",n.error,5e3)}})):h.push(window.message_information.message_error("input#"+$(s).attr("id"),"erreur","le champ "+t+" est vide",5e3));return h}},this.each(function(){return $(this).bind("click",function(){var t,n,s,o,u,a,f,l,c;if($(this).hasClass("is-editing")){i.element_clicked=this,a=$(window).height()*.5,u=$(window).width()*.5,s=$(this).offset(),l=$(document).scrollTop(),console.log(l),f=parseInt(s.top)-l-a,o=parseInt(s.left)-u,i.top=f,i.left=o,console.log(i);if(e.url_to_update===void 0||e.url_to_update==="")e.url_to_update=e.url_get_infos;i.table_get_infos=e.url_get_infos[e.url_get_infos.length-1],i.table_to_update=e.url_to_update[e.url_to_update.length-1],i.id_entite_get_infos=$(this).parents("div").prevAll("div.informations_card").children("input.id_"+i.table_get_infos).val(),i.id_entite_update=$(this).parents("div").prevAll("div.informations_card").children("input.id_"+i.table_to_update).val(),i.the_url_get_infos="/administration",i.the_url_to_update="/administration";if(e.url_get_infos!==void 0){i.url_get_infos={},n=0;while(n<e.url_get_infos.length)t="level_"+n,i.url_get_infos[t]=e.url_get_infos[n],n===0?i.the_url_get_infos+="/"+e.url_get_infos[n]+"s/"+i.user_id:i.the_url_get_infos+="/"+e.url_get_infos[n]+"s/"+i.id_entite_get_infos,n++}i.url_to_update={},n=0;while(n<e.url_to_update.length)t="level_"+n,i.url_to_update[t]=e.url_to_update[n],n===0?i.the_url_to_update+="/"+e.url_to_update[n]+"s/"+i.user_id:i.the_url_to_update+="/"+e.url_to_update[n]+"s/"+i.id_entite_update,n++;return c=this,$.when(r.get_information()).done(function(e){return r.show_form(e)}),this}})})}}).call(this);