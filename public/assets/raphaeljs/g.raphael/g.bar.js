/*!
 * g.Raphael 0.5 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
(function(){function n(n,r,i,s,o,u,a,f){var l,c={round:"round",sharp:"sharp",soft:"soft",square:"square"};if(o&&!s||!o&&!i)return a?"":f.path();u=c[u]||"square",s=Math.round(s),i=Math.round(i),n=Math.round(n),r=Math.round(r);switch(u){case"round":if(!o){var h=~~(s/2);i<h?(h=i,l=["M",n+.5,r+.5-~~(s/2),"l",0,0,"a",h,~~(s/2),0,0,1,0,s,"l",0,0,"z"]):l=["M",n+.5,r+.5-h,"l",i-h,0,"a",h,h,0,1,1,0,s,"l",h-i,0,"z"]}else h=~~(i/2),s<h?(h=s,l=["M",n-~~(i/2),r,"l",0,0,"a",~~(i/2),h,0,0,1,i,0,"l",0,0,"z"]):l=["M",n-h,r,"l",0,h-s,"a",h,h,0,1,1,i,0,"l",0,s-h,"z"];break;case"sharp":if(!o){var p=~~(s/2);l=["M",n,r+p,"l",0,-s,t(i-p,0),0,e(p,i),p,-e(p,i),p+(p*2<s),"z"]}else p=~~(i/2),l=["M",n+p,r,"l",-i,0,0,-t(s-p,0),p,-e(p,s),p,e(p,s),p,"z"];break;case"square":o?l=["M",n+~~(i/2),r,"l",1-i,0,0,-s,i-1,0,"z"]:l=["M",n,r+~~(s/2),"l",0,-s,i,0,0,s,"z"];break;case"soft":o?(h=e(Math.round(i/5),s),l=["M",n-~~(i/2),r,"l",0,h-s,"a",h,h,0,0,1,h,-h,"l",i-2*h,0,"a",h,h,0,0,1,h,h,"l",0,s-h,"z"]):(h=e(i,Math.round(s/5)),l=["M",n+.5,r+.5-~~(s/2),"l",i-h,0,"a",h,h,0,0,1,h,h,"l",0,s-h*2,"a",h,h,0,0,1,-h,h,"l",h-i,0,"z"])}return a?l.join(","):f.path(l)}function r(e,t,r,i,s,o,u){u=u||{};var a=this,f=u.type||"square",l=parseFloat(u.gutter||"20%"),c=e.set(),h=e.set(),p=e.set(),d=e.set(),v=Math.max.apply(Math,o),m=[],g=0,y=u.colors||a.colors,b=o.length;if(Raphael.is(o[0],"array")){v=[],g=b,b=0;for(var w=o.length;w--;)h.push(e.set()),v.push(Math.max.apply(Math,o[w])),b=Math.max(b,o[w].length);if(u.stacked)for(var w=b;w--;){var E=0;for(var S=o.length;S--;)E+=+o[S][w]||0;m.push(E)}for(var w=o.length;w--;)if(o[w].length<b)for(var S=b;S--;)o[w].push(0);v=Math.max.apply(Math,u.stacked?m:v)}v=u.to||v;var x=i/(b*(100+l)+l)*100,T=x*l/100,N=u.vgutter==null?20:u.vgutter,C=[],k=t+T,L=(s-2*N)/v;u.stretch||(T=Math.round(T),x=Math.floor(x)),!u.stacked&&(x/=g||1);for(var w=0;w<b;w++){C=[];for(var S=0;S<(g||1);S++){var A=Math.round((g?o[S][w]:o[w])*L),O=r+s-N-A,M=n(Math.round(k+x/2),O+A,x,A,!0,f,null,e).attr({stroke:"none",fill:y[g?S:w]});g?h[S].push(M):h.push(M),M.y=O,M.x=Math.round(k+x/2),M.w=x,M.h=A,M.value=g?o[S][w]:o[w],u.stacked?C.push(M):k+=x}if(u.stacked){var _;d.push(_=e.rect(C[0].x-C[0].w/2,r,x,s).attr(a.shim)),_.bars=e.set();var D=0;for(var P=C.length;P--;)C[P].toFront();for(var P=0,H=C.length;P<H;P++){var M=C[P],B,A=(D+M.value)*L,j=n(M.x,r+s-N-!!D*.5,x,A,!0,f,1,e);_.bars.push(M),D&&M.attr({path:j}),M.h=A,M.y=r+s-N-!!D*.5-A,p.push(B=e.rect(M.x-M.w/2,M.y,x,M.value*L).attr(a.shim)),B.bar=M,B.value=M.value,D+=M.value}k+=x}k+=T}d.toFront(),k=t+T;if(!u.stacked)for(var w=0;w<b;w++){for(var S=0;S<(g||1);S++){var B;p.push(B=e.rect(Math.round(k),r+N,x,s-N).attr(a.shim)),B.bar=g?h[S][w]:h[w],B.value=B.bar.value,k+=x}k+=T}return c.label=function(t,n){t=t||[],this.labels=e.set();var i,a=-Infinity;if(u.stacked)for(var f=0;f<b;f++){var l=0;for(var c=0;c<(g||1);c++){l+=g?o[c][f]:o[f];if(c==g-1){var d=e.labelise(t[f],l,v);i=e.text(h[f*(g||1)+c].x,r+s-N/2,d).attr(txtattr).insertBefore(p[f*(g||1)+c]);var m=i.getBBox();m.x-7<a?i.remove():(this.labels.push(i),a=m.x+m.width)}}}else for(var f=0;f<b;f++)for(var c=0;c<(g||1);c++){var d=e.labelise(g?t[c]&&t[c][f]:t[f],g?o[c][f]:o[f],v);i=e.text(h[f*(g||1)+c].x,n?r+s-N/2:h[f*(g||1)+c].y-10,d).attr(txtattr).insertBefore(p[f*(g||1)+c]);var m=i.getBBox();m.x-7<a?i.remove():(this.labels.push(i),a=m.x+m.width)}return this},c.hover=function(e,t){return d.hide(),p.show(),p.mouseover(e).mouseout(t),this},c.hoverColumn=function(e,t){return p.hide(),d.show(),t=t||function(){},d.mouseover(e).mouseout(t),this},c.click=function(e){return d.hide(),p.show(),p.click(e),this},c.each=function(e){if(!Raphael.is(e,"function"))return this;for(var t=p.length;t--;)e.call(p[t]);return this},c.eachColumn=function(e){if(!Raphael.is(e,"function"))return this;for(var t=d.length;t--;)e.call(d[t]);return this},c.clickColumn=function(e){return p.hide(),d.show(),d.click(e),this},c.push(h,p,d),c.bars=h,c.covers=p,c}function i(e,t,r,i,s,o,u){u=u||{};var a=this,f=u.type||"square",l=parseFloat(u.gutter||"20%"),c=e.set(),h=e.set(),p=e.set(),d=e.set(),v=Math.max.apply(Math,o),m=[],g=0,y=u.colors||a.colors,b=o.length;if(Raphael.is(o[0],"array")){v=[],g=b,b=0;for(var w=o.length;w--;)h.push(e.set()),v.push(Math.max.apply(Math,o[w])),b=Math.max(b,o[w].length);if(u.stacked)for(var w=b;w--;){var E=0;for(var S=o.length;S--;)E+=+o[S][w]||0;m.push(E)}for(var w=o.length;w--;)if(o[w].length<b)for(var S=b;S--;)o[w].push(0);v=Math.max.apply(Math,u.stacked?m:v)}v=u.to||v;var x=Math.floor(s/(b*(100+l)+l)*100),T=Math.floor(x*l/100),N=[],C=r+T,k=(i-1)/v;!u.stacked&&(x/=g||1);for(var w=0;w<b;w++){N=[];for(var S=0;S<(g||1);S++){var L=g?o[S][w]:o[w],A=n(t,C+x/2,Math.round(L*k),x-1,!1,f,null,e).attr({stroke:"none",fill:y[g?S:w]});g?h[S].push(A):h.push(A),A.x=t+Math.round(L*k),A.y=C+x/2,A.w=Math.round(L*k),A.h=x,A.value=+L,u.stacked?N.push(A):C+=x}if(u.stacked){var O=e.rect(t,N[0].y-N[0].h/2,i,x).attr(a.shim);d.push(O),O.bars=e.set();var M=0;for(var _=N.length;_--;)N[_].toFront();for(var _=0,D=N.length;_<D;_++){var A=N[_],P,L=Math.round((M+A.value)*k),H=n(t,A.y,L,x-1,!1,f,1,e);O.bars.push(A),M&&A.attr({path:H}),A.w=L,A.x=t+L,p.push(P=e.rect(t+M*k,A.y-A.h/2,A.value*k,x).attr(a.shim)),P.bar=A,M+=A.value}C+=x}C+=T}d.toFront(),C=r+T;if(!u.stacked)for(var w=0;w<b;w++){for(var S=0;S<(g||1);S++){var P=e.rect(t,C,i,x).attr(a.shim);p.push(P),P.bar=g?h[S][w]:h[w],P.value=P.bar.value,C+=x}C+=T}return c.label=function(n,r){n=n||[],this.labels=e.set();for(var i=0;i<b;i++)for(var s=0;s<g;s++){var u=e.labelise(g?n[s]&&n[s][i]:n[i],g?o[s][i]:o[i],v),a=r?h[i*(g||1)+s].x-x/2+3:t+5,f=r?"end":"start",l;this.labels.push(l=e.text(a,h[i*(g||1)+s].y,u).attr(txtattr).attr({"text-anchor":f}).insertBefore(p[0])),l.getBBox().x<t+5?l.attr({x:t+5,"text-anchor":"start"}):h[i*(g||1)+s].label=l}return this},c.hover=function(e,t){return d.hide(),p.show(),t=t||function(){},p.mouseover(e).mouseout(t),this},c.hoverColumn=function(e,t){return p.hide(),d.show(),t=t||function(){},d.mouseover(e).mouseout(t),this},c.each=function(e){if(!Raphael.is(e,"function"))return this;for(var t=p.length;t--;)e.call(p[t]);return this},c.eachColumn=function(e){if(!Raphael.is(e,"function"))return this;for(var t=d.length;t--;)e.call(d[t]);return this},c.click=function(e){return d.hide(),p.show(),p.click(e),this},c.clickColumn=function(e){return p.hide(),d.show(),d.click(e),this},c.push(h,p,d),c.bars=h,c.covers=p,c}var e=Math.min,t=Math.max,s=function(){};s.prototype=Raphael.g,i.prototype=r.prototype=new s,Raphael.fn.hbarchart=function(e,t,n,r,s,o){return new i(this,e,t,n,r,s,o)},Raphael.fn.barchart=function(e,t,n,i,s,o){return new r(this,e,t,n,i,s,o)}})();