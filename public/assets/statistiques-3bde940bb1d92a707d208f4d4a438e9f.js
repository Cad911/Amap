(function(){$(document).ready(function(){return window.statisitques={user_id:$(".user_id").val(),init:function(){return statisitques.data_month(),statisitques.data_year()},data_month:function(){return $.ajax({type:"POST",url:"/administration/users/"+statisitques.user_id+"/ca_by_month",async:!1,format:"json",success:function(e){var t;return t=e,statisitques.create_pie(e)}})},data_year:function(){return $.ajax({type:"POST",url:"/administration/users/"+statisitques.user_id+"/ca_by_year",async:!1,format:"json",success:function(e){var t,n,r,i;n=e,r=1,t=[];while(r<=12)r<10?i="0"+r:i=r,t.push({q:"2012-"+i,a:n.CA_increment[r].CA_product_ttc,b:n.CA_increment[r].CA_abonnement_ttc}),r++;return statisitques.create_graph(t)}})},create_pie:function(e){var t,n,r,i,s;return console.log(e),e.CA_total_ttc===0?(r=$(document.createElement("h2")),r.text("Aucun chiffre d'affaire ce mois-ci"),$("#camembert").append(r)):(s=Raphael("camembert"),e.CA_product_ttc===0?(n=[1e-5,e.CA_abonnement_ttc],t=s.piechart(320,240,70,n,{legend:["0% - 0 € ","%% - "+n[1]+" € "],legendpos:"est",colors:["#59a494","#ea9d6e"]})):e.CA_abonnement_ttc===0?(n=[e.CA_product_ttc,1e-5],t=s.piechart(320,240,70,n,{legend:["%% - "+n[0]+" € ","0% - 0 € "],legendpos:"est",colors:["#59a494","#ea9d6e"]})):(n=[e.CA_product_ttc,e.CA_abonnement_ttc],n=[e.CA_product_ttc,e.CA_abonnement_ttc],t=s.piechart(320,240,70,n,{legend:["%% - "+n[0]+" € ","%% - "+n[1]+" €"],legendpos:"est",colors:["#59a494","#ea9d6e"]})),$("#camembert path").css("box-shadow","1px 1px 1px solid black"),t.hover(function(){this.sector.stop(),this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label)return this.label[0].stop(),this.label[0].attr({r:7.5}),this.label[1].attr({"font-weight":800})},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label)return this.label[0].animate({r:5},500,"bounce"),this.label[1].attr({"font-weight":400})}),i=0,$("body .backoffice .l_wrapper #camembert svg text").each(function(){var e;return e=parseInt($(this).attr("x")),e-=25,$(this).attr("x",e),i===0?$(this).attr("fill","#59a494"):$(this).attr("fill","#ea9d6e"),i++}))},create_graph:function(e){return Morris.Line({element:"graph",data:e,xkey:"q",ykeys:["a","b"],labels:["CA produit","CA abonnement"],lineColors:["#59a494","#ea9d6e"],lineWidth:2,smooth:!1,pointSize:3,hideHover:!0,xLabels:"month",xLabelFormat:function(e){switch(e.getMonth()){case 0:return"Jan.";case 1:return"Fév.";case 2:return"Ma.";case 3:return"Av.";case 4:return"Mai";case 5:return"Juin";case 6:return"Juil.";case 7:return"Aout";case 8:return"Sep.";case 9:return"Oct.";case 10:return"Nov.";case 11:return"Déc."}}})},hide:function(){return $("#statistiques").slideUp(500)},show:function(){return $("#statistiques").slideDown(500)},clear_stats:function(){return $("#camembert").html(""),$("#graph").html("")}}})}).call(this);